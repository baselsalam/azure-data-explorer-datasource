/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","emotion","lodash","@grafana/data","@grafana/runtime","app/core/config","angular"],(function(e,t,n,r,a,o,i,l){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=12)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=a},function(e,t){e.exports=o},function(e,t){e.exports=i},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.create;Object.create},function(e,t,n){"use strict";function r(e){return"function"==typeof e?e():e}function a(){var e={};return e.promise=new Promise((function(t,n){e.resolve=t,e.reject=n})),e}e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=void 0,i=void 0,l=void 0,u=[];return function(){var c=r(t),p=(new Date).getTime(),d=!o||p-o>c;o=p;for(var m=arguments.length,f=Array(m),v=0;v<m;v++)f[v]=arguments[v];if(d&&n.leading)return n.accumulate?Promise.resolve(e.call(this,[f])).then((function(e){return e[0]})):Promise.resolve(e.call.apply(e,[this].concat(f)));if(i?clearTimeout(l):i=a(),u.push(f),l=setTimeout(s.bind(this),c),n.accumulate){var h=u.length-1;return i.promise.then((function(e){return e[h]}))}return i.promise};function s(){var t=i;clearTimeout(l),Promise.resolve(n.accumulate?e.call(this,u):e.apply(this,u[u.length-1])).then(t.resolve,t.reject),u=[],i=null}}},function(e,t){e.exports=l},,function(e){e.exports=JSON.parse('{"name":"grafana-azure-data-explorer-datasource","version":"3.2.1","description":"Grafana data source for Azure Data Explorer","scripts":{"build":"grafana-toolkit plugin:build","test":"grafana-toolkit plugin:test","dev":"grafana-toolkit plugin:dev","watch":"grafana-toolkit plugin:dev --watch"},"author":"Grafana Labs","license":"Apache","devDependencies":{"@grafana/data":"7.1.1","@grafana/e2e":"7.1.1","@grafana/eslint-config":"2.0.0","@grafana/runtime":"7.1.1","@grafana/toolkit":"7.3.1","@grafana/ui":"7.1.4","@testing-library/react":"^10.4.6","@types/angular":"1.6.49","@types/debounce-promise":"^3.1.2","@types/grafana":"github:CorpGlory/types-grafana.git","@types/lodash":"^4.14.158","@typescript-eslint/eslint-plugin":"3.6.0","@typescript-eslint/parser":"3.6.0","eslint":"7.4.0","eslint-config-prettier":"6.11.0","eslint-plugin-jsdoc":"28.6.1","eslint-plugin-prettier":"3.1.4","eslint-plugin-react-hooks":"4.0.5","jest-environment-jsdom-sixteen":"^1.0.3","monaco-editor":"0.17.0","ts-jest":"^26.4.3"},"dependencies":{"debounce-promise":"^3.1.2","react-use":"^15.3.3"}}')},function(e,t,n){"use strict";n.r(t);var r=n(4),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function l(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}function u(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function l(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}u((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}function c(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}function d(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}function m(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var f,v=n(3),h=n.n(v),y=n(5),g=function(){function e(){}return e.prototype.parseDatabases=function(e){var t,n,r,a,o=[];if(!e||!e.data||!e.data.Tables||0===e.data.Tables.length)return o;try{for(var i=c(e.data.Tables),l=i.next();!l.done;l=i.next()){var u=l.value;try{for(var s=(r=void 0,c(u.Rows)),p=s.next();!p.done;p=s.next()){var d=p.value;o.push({text:d[5]||d[0],value:d[0]})}}catch(e){r={error:e}}finally{try{p&&!p.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return o},e.prototype.parseSchemaResult=function(e){var t=e.Tables[0].Rows[0][0];return JSON.parse(t)},e}();!function(e){e.Property="property",e.Operator="operator",e.Reduce="reduce",e.FunctionParameter="functionParameter",e.GroupBy="groupBy",e.Or="or",e.And="and"}(f||(f={}));var b,w=n(11);!function(e){e.Visual="visual",e.Raw="raw"}(b||(b={}));var x,C={query:"",querySource:b.Raw,expression:{where:{type:f.And,expressions:[]},groupBy:{type:f.And,expressions:[]},reduce:{type:f.And,expressions:[]}},pluginVersion:w.version};!function(e){e.function="function",e.table="table",e.materializedView="materializedView"}(x||(x={}));var O={userId:"userId",login:"login",email:"email",avatarUrl:"avatarUrl",time:"time",timeEnd:"timeEnd",title:"title",text:"text",tags:"tags"};function E(e,t){if(!e)return"";return(e=(e=e.replace(/\$__([_a-zA-Z0-9]+)\(([^\)]*)\)/gi,(function(e,t,n){return"contains"===t?function(e){var t=e.indexOf(","),n=e.substring(0,t),r=e.substring(e.indexOf(",")+1);if(r&&"all"===r.toLowerCase().trim())return"1 == 1";return n.trim()+" in ("+S(r.trim())+")"}(n):e}))).replace(/\$(__interval|__interval_ms)/gi,(function(e,n){var r;if(!t)return e;var a=t[n];return null!==(r=null==a?void 0:a.value)&&void 0!==r?r:e}))).replace(/\$__escapeMulti\(('[^]*')\)/gi,(function(e,t){return(n=t).substring(1,n.length-1).split("','").map((function(e){return"@'"+e+"'"})).join(", ");var n}))}function S(e){return e.match(/,+/i)?e.split(",").map(S).join(","):e.match(/^'(.*)'$/i)?e:"'"+e+"'"}var j,T={},F=function(e,t,n){return void 0===n&&(n=!1),u(void 0,void 0,Promise,(function(){var r;return s(this,(function(a){switch(a.label){case 0:return T[e]&&!n?[3,2]:[4,t()];case 1:r=a.sent(),T[e]=r,a.label=2;case 2:return[2,T[e]]}}))}))};!function(e){e.Number="number",e.String="string",e.Boolean="boolean",e.DateTime="dateTime",e.TimeSpan="timeSpan",e.Function="function",e.Interval="interval"}(j||(j={}));var V=function(e){return(null==e?void 0:e.type)===f.Reduce},k=function(e){return(null==e?void 0:e.type)===f.Property},N=function(e){return(null==e?void 0:e.type)===f.Operator},D=function(e){return(null==e?void 0:e.type)===f.GroupBy},M=function(e){return Array.isArray(null==e?void 0:e.value)},_=function(e){return(null==e?void 0:e.type)===f.And},A=function(e){return(null==e?void 0:e.type)===f.Or},P=function(e){return _(e)||A(e)},q=function(){function e(e){void 0===e&&(e=Object(y.getTemplateSrv)()),this.templateSrv=e}return e.prototype.toAutoCompleteQuery=function(e,t){if(!(null==e?void 0:e.expression)||!e.expression.from||!e.search.property)return"";var n={timeColumn:I(t,null==e?void 0:e.expression),castIfDynamic:function(e){return B(e,t)}},r=[];this.appendProperty(n,e.expression.from,r),this.appendTimeFilter(n,void 0,r);var a=Q(e.index,e.expression.where,e.search),o=e.search.property.name;return this.appendWhere(n,a,r,"where"),r.push("take 50000"),r.push("distinct "+n.castIfDynamic(o)),r.push("take 251"),r.join("\n| ")},e.prototype.toQuery=function(e,t){if(!e||!e.from)return"";var n={timeColumn:I(t,e),castIfDynamic:function(e){return B(e,t)}},r=[];return this.appendProperty(n,e.from,r),this.appendTimeFilter(n,e.timeshift,r),this.appendWhere(n,null==e?void 0:e.where,r,"where"),this.appendTimeshift(n,e.timeshift,r),this.appendSummarize(n,e.reduce,e.groupBy,r),this.appendOrderBy(n,e.groupBy,e.reduce,r),0===r.length?"":r.join("\n| ")},e.prototype.appendTimeshift=function(e,t,n){var r=G(e,t);r&&n.push("extend "+e.timeColumn+" = "+e.timeColumn+" + "+r)},e.prototype.appendTimeFilter=function(e,t,n){if(e.timeColumn){var r=G(e,t);r?n.push("where "+e.timeColumn+" between (($__timeFrom - "+r+") .. ($__timeTo - "+r+"))"):$(e.timeColumn)?n.push("where "+e.timeColumn+" between ($__timeFrom .. $__timeTo)"):n.push("where $__timeFilter("+e.timeColumn+")")}},e.prototype.appendOrderBy=function(e,t,n,r){if(e.timeColumn){var a=Array.isArray(t.expressions)&&0===t.expressions.length,o=Array.isArray(n.expressions)&&0===n.expressions.length;if(a&&o)r.push("order by "+e.timeColumn+" asc");else t.expressions.find((function(e){return!(!D(e)||!e.interval)}))&&r.push("order by "+e.timeColumn+" asc")}},e.prototype.appendWhere=function(e,t,n,r){var a=this;if(t){if(_(t))return t.expressions.forEach((function(t){return a.appendWhere(e,t,n,r)}));if(A(t)){var o=[];if(t.expressions.map((function(t){return a.appendWhere(e,t,o)})),0===o.length)return;return n.push("where "+o.join(" or "))}return N(t)?this.appendOperator(e,t,n,r):void 0}},e.prototype.appendSummarize=function(e,t,n,r){var a,o,i,l,u,s,p=this,d=!1,m=[],f=[],v=[];try{for(var h=c(null!==(u=null==t?void 0:t.expressions)&&void 0!==u?u:[]),y=h.next();!y.done;y=h.next()){var g=y.value;if(V(g)){var b=g.reduce.name,w=g.parameters,x=e.castIfDynamic(g.property.name);if(v.push(x),Array.isArray(w)){var C=w.map((function(e){return p.formatValue(e.value,e.fieldType)})).join(", ");m.push(b+"("+x+", "+C+")")}else"count"!==b?"none"===b||m.push(b+"("+x+")"):d||(d=!0,m.push("count()"))}}}catch(e){a={error:e}}finally{try{y&&!y.done&&(o=h.return)&&o.call(h)}finally{if(a)throw a.error}}try{for(var O=c(null!==(s=null==n?void 0:n.expressions)&&void 0!==s?s:[]),E=O.next();!E.done;E=O.next()){g=E.value;if(D(g)){x=e.castIfDynamic(g.property.name);if(g.interval){var S=g.interval.name;f.unshift("bin("+x+", "+S+")")}else f.push(x)}}}catch(e){i={error:e}}finally{try{E&&!E.done&&(l=O.return)&&l.call(O)}finally{if(i)throw i.error}}if(m.length>0)return f.length>0?void r.push("summarize "+m.join(", ")+" by "+f.join(", ")):void r.push("summarize "+m.join(", "));f.length>0?r.push("summarize by "+f.join(", ")):v.length>0&&r.push("project "+v.join(", "))},e.prototype.appendOperator=function(e,t,n,r){var a=t.property,o=t.operator;if(a.name&&o.name)switch(o.name){case"isnotempty":n.push(R(o.name+"("+a.name+")",r));break;default:var i=this.formatValue(o.value,a.type);n.push(R(a.name+" "+o.name+" "+i,r))}},e.prototype.formatValue=function(e,t){var n=this;if(Array.isArray(e))return"("+e.map((function(e){return n.formatValue(e,t)})).join(", ")+")";if(this.isTemplateVariable(e))return e;switch(t){case j.Number:case j.Boolean:return e;default:return"'"+e+"'"}},e.prototype.appendProperty=function(e,t,n){n.push(t.property.name)},e.prototype.isTemplateVariable=function(e){return!!Array.isArray(this.templateSrv.getVariables())&&!!this.templateSrv.getVariables().find((function(t){return"$"+(null==t?void 0:t.id)===e}))},e}(),R=function(e,t){return t?t+" "+e:e},I=function(e,t){if(Array.isArray(null==t?void 0:t.groupBy.expressions)){var n=null==t?void 0:t.groupBy.expressions.find((function(e){return!!D(e)&&(e.property.type===j.DateTime&&e.interval)}));if(D(n))return B(n.property.name,e)}if(Array.isArray(e)){var r=null==e?void 0:e.find((function(e){return"datetime"===e.CslType&&-1===e.Name.indexOf(".")}));if(r)return null==r?void 0:r.Name;var a=null==e?void 0:e.find((function(e){return"datetime"===e.CslType}));return a?L(a):a}},$=function(e){return!!(e&&e.indexOf(".")>-1)||!!(e&&e.indexOf("todynamic")>-1)},B=function(e,t){if(!$(e)||!Array.isArray(t))return e;var n=t.find((function(t){return t.Name===e}));return n?L(n):e},L=function(e){var t=e.Name.split(".");return t.reduce((function(n,r,a){return n?a+1===t.length?"to"+e.CslType+"("+n+"."+r+")":"todynamic("+n+"."+r+")":"todynamic("+r+")"}),"")},Q=function(e,t,n){for(var r=e.split("-").map((function(e){return parseInt(e,10)})),a=Object(v.cloneDeep)(t),o=a.expressions,i=0;i<r.length;i++){var l=r[i];if(i===r.length-1){o[l]=n;break}if(Array.isArray(o)){var u=o[l];if(P(u)){o=u.expressions;continue}}}return a},G=function(e,t){if(!t||!e.timeColumn||!t.property)return null;var n=t.property.name;return/^(\d{1,15}(?:d|h|ms|s|m){0,1})$/gm.test(n)?n:null},W=function(e){return{value:e.Name,label:e.Name,type:j.String}},z=function(e){switch(e){case"real":case"int":case"long":return j.Number;case"datetime":return j.DateTime;case"bool":return j.Boolean;default:return j.String}},U=function(){function e(e,t){var n,r;void 0===e&&(e=!1),void 0===t&&(t=[]),this.enabled=e,this.mappingsByDatabase={},this.displayNameToMapping={},this.nameToMapping={},this.valueToMapping={};try{for(var a=c(t),o=a.next();!o.done;o=a.next()){var i=o.value;Array.isArray(this.mappingsByDatabase[i.database])||(this.mappingsByDatabase[i.database]=[]),this.mappingsByDatabase[i.database].push(i),this.displayNameToMapping[i.displayName]=i,this.nameToMapping[i.name]=i,this.valueToMapping[i.value]=i}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}return e.prototype.getMappingByValue=function(e){if(this.enabled&&e)return this.valueToMapping[e]},e.prototype.getTableOptions=function(e,t){var n=e.Databases[t];if(!n||!n.Tables)return[];if(!this.enabled)return Object.keys(n.Tables).map((function(e){return function(e){return{label:e.Name,value:e.Name,type:j.String}}(n.Tables[e])}));var r=this.mappingsByDatabase[t];return K(n,r)},e}(),K=function(e,t){return void 0===t&&(t=[]),t.reduce((function(t,n){return n.type===x.table&&e.Tables[n.name]||n.type===x.materializedView&&e.MaterializedViews[n.name]||n.type===x.function&&e.Functions[n.name]?(t.push(H(n)),t):t}),[])},H=function(e){return{type:j.String,label:e.displayName,value:e.value}};function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var X=function(e){function t(t){var n,r,a,o=e.call(this,t)||this,i=null!==(n=t.jsonData.useSchemaMapping)&&void 0!==n&&n,l=null!==(r=t.jsonData.schemaMappings)&&void 0!==r?r:[];return o.backendSrv=Object(y.getBackendSrv)(),o.templateSrv=Object(y.getTemplateSrv)(),o.baseUrl="/azuredataexplorer",o.defaultOrFirstDatabase=t.jsonData.defaultDatabase,o.url=t.url,o.defaultEditorMode=null!==(a=t.jsonData.defaultEditorMode)&&void 0!==a?a:b.Visual,o.schemaMapper=new U(i,l),o.expressionParser=new q(o.templateSrv),o.parseExpression=o.parseExpression.bind(o),o.autoCompleteQuery=o.autoCompleteQuery.bind(o),o.getSchemaMapper=o.getSchemaMapper.bind(o),o}return o(t,e),t.prototype.filterQuery=function(e){var t,n;if(e.hide||!e.query)return!1;if(void 0===e.rawMode&&e.query)return!0;if(e.rawMode)return!0;var r=null===(t=e.expression)||void 0===t?void 0:t.from;return!!r&&!!(null===(n=r.property)||void 0===n?void 0:n.name)},t.prototype.applyTemplateVariables=function(e,t){var n=E(e.query,t);return i(i({},e),{query:this.templateSrv.replace(n,t,this.interpolateVariable),database:this.templateSrv.replace(e.database,t)})},t.prototype.annotationQuery=function(t){return u(this,void 0,Promise,(function(){var n;return s(this,(function(a){return(n=t.annotation)?(n.resultFormat="table",[2,e.prototype.query.call(this,{targets:[n],range:t.range,maxDataPoints:200,interval:"10ms",intervalMs:1e4}).toPromise().then((function(e){var n;return e.state===r.LoadingState.Done&&(null===(n=e.data)||void 0===n?void 0:n.length)?function(e,t){var n,a,o,l,u,s,d,m=[];if(!e||!e.length)return m;var f=!1,v=!1,h={};try{for(var y=c(e.fields),g=y.next();!g.done;g=y.next()){h[(_=g.value).name.toLowerCase()]=_}}catch(e){n={error:e}}finally{try{g&&!g.done&&(a=y.return)&&a.call(y)}finally{if(n)throw n.error}}var b=[],w=i(i({},O),null==t?void 0:t.field);try{for(var x=c(Object.entries(w)),C=x.next();!C.done;C=x.next()){var E=p(C.value,2),S=E[0],j=E[1],T=j?j.toLowerCase():"";if(T&&h[T]){var F={key:S,field:h[T]};switch(S){case"time":f=!0;break;case"text":v=!0;break;case"tags":F.split=","}(null==t?void 0:t.regex)&&t.regex[S]&&(F.regex=new RegExp(t.regex[S])),b.push(F)}}}catch(e){o={error:e}}finally{try{C&&!C.done&&(l=x.return)&&l.call(x)}finally{if(o)throw o.error}}if(!f){if(!(V=e.fields.find((function(e){return e.type===r.FieldType.time}))))return[];b.push({key:"time",field:V})}if(!v){var V;if(!(V=e.fields.find((function(e){return e.type===r.FieldType.string}))))return[];(null===(d=null==t?void 0:t.regex)||void 0===d?void 0:d.text)?b.push({key:"time",field:V,regex:new RegExp(t.regex.text)}):b.push({key:"time",field:V})}for(var k=0;k<e.length;k++){var N={};try{for(var D=(u=void 0,c(b)),M=D.next();!M.done;M=D.next()){var _;F=(_=M.value).field.values.get(k);if(_.regex){var A=_.regex.exec(F);A&&(F=A[1]?A[1]:A[0])}_.split&&(F=F.split(",")),N[_.key]=F}}catch(e){u={error:e}}finally{try{M&&!M.done&&(s=D.return)&&s.call(D)}finally{if(u)throw u.error}}m.push(N)}return m}(e.data[0],{field:{time:"StartTime"}}):e.state===r.LoadingState.Error?(console.log("ADX Annotation ERROR???",t,e),Promise.reject({message:t.annotation.name})):[]}))]):[2,Promise.reject({message:"Query missing in annotation definition"})]}))}))},t.prototype.metricFindQuery=function(e,t){return u(this,void 0,Promise,(function(){var n=this;return s(this,(function(a){return e.match(/^databases\(\)/i)?[2,this.getDatabases()]:[2,this.getDefaultOrFirstDatabase().then((function(r){return n.buildQuery(e,t,r)})).then((function(e){return n.query({targets:[e]}).toPromise()})).then((function(e){return e.data&&e.data.length?function(e){var t=[],n=e.fields.find((function(e){return e.type===r.FieldType.string}));if(n)for(var a=0;a<n.values.length;a++)t.push({text:n.values.get(a)});return t}(e.data[0]):[]})).catch((function(e){throw console.log("There was an error",e),e}))]}))}))},t.prototype.getDatabases=function(){return u(this,void 0,Promise,(function(){var e,t;return s(this,(function(n){return e=this.baseUrl+"/v1/rest/mgmt",t={csl:".show databases"},[2,this.doRequest(e,t).then((function(e){return(new g).parseDatabases(e)}))]}))}))},t.prototype.getDefaultOrFirstDatabase=function(){return u(this,void 0,Promise,(function(){var e=this;return s(this,(function(t){return this.defaultOrFirstDatabase?[2,Promise.resolve(this.defaultOrFirstDatabase)]:[2,this.getDatabases().then((function(t){return e.defaultOrFirstDatabase=t[0].value,e.defaultOrFirstDatabase}))]}))}))},t.prototype.getSchema=function(e){return void 0===e&&(e=!1),u(this,void 0,Promise,(function(){var t=this;return s(this,(function(n){return[2,F(this.id+".schema.overview",(function(){var e=t.baseUrl+"/v1/rest/mgmt";return t.doRequest(e,{querySource:"schema",csl:".show databases schema as json"}).then((function(e){return(new g).parseSchemaResult(e.data)}))}),e)]}))}))},t.prototype.getFunctionSchema=function(e,t){return u(this,void 0,Promise,(function(){var n,r,a;return s(this,(function(o){switch(o.label){case 0:return"take 50000",(n=[]).push(t),n.push("take 50000"),n.push("getschema"),r=this.buildQuery(n.join("\n | "),{},e),[4,this.query({targets:[i(i({},r),{querySource:"schema"})]}).toPromise()];case 1:return a=o.sent(),[2,J(a.data)]}}))}))},t.prototype.getDynamicSchema=function(e,t,n){return u(this,void 0,Promise,(function(){var r,a,o,l,u,c;return s(this,(function(s){switch(s.label){case 0:return e&&t&&Array.isArray(n)&&0!==n.length?(r=[],"take 50000",a="where "+n.map((function(e){return"isnotnull("+e+")"})).join(" and "),o="project "+n.map((function(e){return e})).join(", "),l="summarize "+n.map((function(e){return"buildschema("+e+")"})).join(", "),r.push(t),r.push("take 50000"),r.push(a),r.push(o),r.push(l),u=this.buildQuery(r.join("\n | "),{},e),[4,this.query({targets:[i(i({},u),{querySource:"schema"})]}).toPromise()]):[2,{}];case 1:return c=s.sent(),[2,Y(c.data)]}}))}))},Object.defineProperty(t.prototype,"variables",{get:function(){return this.templateSrv.getVariables().map((function(e){return"$"+e.name}))},enumerable:!1,configurable:!0}),t.prototype.buildQuery=function(e,t,n){t||(t={}),t.hasOwnProperty("scopedVars")||(t.scopedVars={});var r=E(e,t.scopedVars);return i(i({},C),{refId:"adx-"+r,resultFormat:"table",rawMode:!0,query:r,database:n})},t.prototype.doRequest=function(e,t,n){var r=this;return void 0===n&&(n=1),this.backendSrv.datasourceRequest({url:this.url+e,method:"POST",data:t}).catch((function(a){if(n>0)return r.doRequest(e,t,n-1);throw a}))},t.prototype.interpolateVariable=function(e,t){return"string"==typeof e?t.multi||t.includeAll?"'"+e+"'":e:"number"==typeof e?e:Object(v.map)(e,(function(t){return"number"==typeof e?e:"'"+ne(t)+"'"})).filter((function(e){return"''"!==e})).join(",")},t.prototype.getSchemaMapper=function(){return this.schemaMapper},t.prototype.parseExpression=function(e,t){return this.expressionParser.toQuery(e,t)},t.prototype.getDefaultEditorMode=function(){return this.defaultEditorMode},t.prototype.autoCompleteQuery=function(e,t){return u(this,void 0,Promise,(function(){var n,r,a,o,l;return s(this,(function(u){switch(u.label){case 0:return(n=this.expressionParser.toAutoCompleteQuery(e,t))?(r=i(i({},C),{refId:"adx-"+n,database:e.database,rawMode:!0,query:n,resultFormat:"table",querySource:"autocomplete"}),[4,this.query(te({targets:[r]})).toPromise()]):[2,[]];case 1:return a=u.sent(),Array.isArray(null==a?void 0:a.data)&&0!==a.data.length?Array.isArray(a.data[0].fields)&&0!==a.data[0].fields.length?(o=a.data[0].fields[0].values.toArray(),[2,"contains"===(l=e.search.operator).name?re(o,l.value):o]):[2,[]]:[2,[]]}}))}))},t}(y.DataSourceWithBackend),J=function(e){var t,n,r=[],a=e[0].fields;if(!a)return r;var o=a.findIndex((function(e){return"ColumnName"===e.name})),i=a.findIndex((function(e){return"ColumnType"===e.name}));if(o<0||i<0)return r;try{for(var l=c(e),u=l.next();!u.done;u=l.next())for(var s=u.value,p=0;p<s.length;p++)r.push({Name:s.fields[o].values.get(p),CslType:s.fields[i].values.get(p)})}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return r},Y=function(e){var t,n,r,a,o={};try{for(var i=c(e),l=i.next();!l.done;l=i.next()){var u=l.value;try{for(var s=(r=void 0,c(u.fields)),p=s.next();!p.done;p=s.next()){var d=p.value,m=JSON.parse(d.values.get(0));if(null!==m){var f=[],v=d.name.replace("schema_","");ee(v,m,f),o[v]=f}else console.log("error with field",d)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return o},ee=function e(t,n,r){var a,o;if(n)try{for(var i=c(Object.keys(n)),l=i.next();!l.done;l=i.next()){var u=l.value,s=t+"."+u;"string"!=typeof n[u]?"object"===Z(n[u])&&e(s,n[u],r):r.push({Name:s,CslType:n[u]})}}catch(e){a={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(a)throw a.error}}else console.log("error with column",t)},te=function(e){var t,n=null===(t=Object(y.getTemplateSrv)())||void 0===t?void 0:t.timeRange;return n?i(i({},e),{range:n}):e},ne=function(e){return e.replace(/\'/gim,"\\'")},re=function(e,t){var n=t.toLowerCase();return e.sort((function(e,t){if(!e&&!t)return 0;if(!e&&t)return-1;if(e&&!t)return 1;var r=e.toLowerCase(),a=t.toLowerCase();return r.startsWith(n)&&a.startsWith(n)?0:r.startsWith(n)&&!a.startsWith(n)&&a.includes(n,1)||r.startsWith(n)&&!a.includes(n,1)?-1:!r.startsWith(n)&&r.includes(n,1)&&a.startsWith(n)||!r.includes(n,1)&&a.startsWith(n)?1:r.includes(n,1)&&!a.includes(n,1)?-1:!r.includes(n,1)&&a.includes(n,1)?1:0})),e},ae=n(0),oe=n.n(ae),ie=n(7);function le(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={loading:!1});var r,a,o=Object(ae.useRef)(0),i=(r=Object(ae.useRef)(!1),a=Object(ae.useCallback)((function(){return r.current}),[]),Object(ae.useEffect)((function(){return r.current=!0,function(){r.current=!1}})),a),l=Object(ae.useState)(n),u=l[0],s=l[1];return[u,Object(ae.useCallback)((function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=++o.current;return s((function(e){return Object(ie.a)(Object(ie.a)({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return i()&&r===o.current&&s({value:e,loading:!1}),e}),(function(e){return i()&&r===o.current&&s({error:e,loading:!1}),e}))}),t)]}function ue(e,t){void 0===t&&(t=[]);var n=le(e,t,{loading:!0}),r=n[0],a=n[1];return Object(ae.useEffect)((function(){a()}),[a]),r}var se,ce,pe,de,me,fe,ve,he,ye,ge,be,we,xe,Ce,Oe,Ee,Se,je,Te,Fe,Ve,ke,Ne,De,Me,_e=n(1),Ae=n(2),Pe=function(){function e(e,t,n,r){this.containerDiv=e,this.defaultTimeField=t,this.getSchema=n,this.config=r,this.splitWithNewLineRegex=/[^\n]+\n?|\n/g,this.newLineRegex=/\r?\n/,this.startsWithKustoPipeRegex=/^\|\s*/g,this.kustoPipeRegexStrict=/^\|\s*$/g}return e.prototype.initMonaco=function(e){var t=this,n=this.config.bootData.user.lightTheme?"grafana-light":"vs-dark";monaco.editor.defineTheme("grafana-light",{base:"vs",inherit:!0,rules:[{token:"comment",foreground:"008000"},{token:"variable.predefined",foreground:"800080"},{token:"function",foreground:"0000FF"},{token:"operator.sql",foreground:"FF4500"},{token:"string",foreground:"B22222"},{token:"operator.scss",foreground:"0000FF"},{token:"variable",foreground:"C71585"},{token:"variable.parameter",foreground:"9932CC"},{token:"",foreground:"000000"},{token:"type",foreground:"0000FF"},{token:"tag",foreground:"0000FF"},{token:"annotation",foreground:"2B91AF"},{token:"keyword",foreground:"0000FF"},{token:"number",foreground:"191970"},{token:"annotation",foreground:"9400D3"},{token:"invalid",background:"cd3131"}],colors:{"textCodeBlock.background":"#FFFFFF"}}),monaco.languages.kusto.kustoDefaults.setLanguageSettings({includeControlCommands:!0,newlineAfterPipe:!0,useIntellisenseV2:!1}),this.codeEditor=monaco.editor.create(this.containerDiv,{value:e||"Write your query here",language:"kusto",selectionHighlight:!1,theme:n,folding:!0,lineNumbers:"off",lineHeight:16,suggestFontSize:13,dragAndDrop:!1,occurrencesHighlight:!1,minimap:{enabled:!1},renderIndentGuides:!1,wordWrap:"on"}),this.codeEditor.layout(),1===monaco.editor.getModels().length&&(this.completionItemProvider=monaco.languages.registerCompletionItemProvider("kusto",{triggerCharacters:["."," "],provideCompletionItems:this.getCompletionItems.bind(this)}),this.signatureHelpProvider=monaco.languages.registerSignatureHelpProvider("kusto",{signatureHelpTriggerCharacters:["(",")"],provideSignatureHelp:this.getSignatureHelp.bind(this)})),this.codeEditor.createContextKey("readyToExecute",!0),this.codeEditor.onDidChangeCursorSelection((function(e){t.onDidChangeCursorSelection(e)})),this.getSchema().then((function(e){e&&monaco.languages.kusto.getKustoWorker().then((function(n){var r,a=null===(r=t.codeEditor)||void 0===r?void 0:r.getModel();a&&n(a.uri).then((function(n){var r,a=Object.keys(e.Databases).length>0?Object.keys(e.Databases)[0]:"";n.setSchemaFromShowSchema(e,"https://help.kusto.windows.net",a),null===(r=t.codeEditor)||void 0===r||r.layout()}))}))}))},e.prototype.resize=function(){var e;null===(e=this.codeEditor)||void 0===e||e.layout()},e.prototype.setOnDidChangeModelContent=function(e){var t;null===(t=this.codeEditor)||void 0===t||t.onDidChangeModelContent(e)},e.prototype.disposeMonaco=function(){if(this.completionItemProvider)try{this.completionItemProvider.dispose()}catch(e){console.error("Failed to dispose the completion item provider.",e)}if(this.signatureHelpProvider)try{this.signatureHelpProvider.dispose()}catch(e){console.error("Failed to dispose the signature help provider.",e)}if(this.codeEditor)try{this.codeEditor.dispose()}catch(e){console.error("Failed to dispose the editor component.",e)}},e.prototype.addCommand=function(e,t){var n;null===(n=this.codeEditor)||void 0===n||n.addCommand(e,t,"readyToExecute")},e.prototype.getValue=function(){var e;return null===(e=this.codeEditor)||void 0===e?void 0:e.getValue()},e.prototype.toSuggestionController=function(e){return e},e.prototype.setEditorContent=function(e){var t;null===(t=this.codeEditor)||void 0===t||t.setValue(e)},e.prototype.getCompletionItems=function(e,t){var n="##### Macro that uses the selected timerange in Grafana to filter the query.\n\n- `$__timeFilter()` -> Uses the "+this.defaultTimeField+" column\n\n- `$__timeFilter(datetimeColumn)` ->  Uses the specified datetime column to build the query.",r=e.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:t.lineNumber,endColumn:t.column});return h.a.includes(r,"|")?h.a.includes(r.toLowerCase(),"where")?h.a.includes(e.getLineContent(t.lineNumber).toLowerCase(),"where")?[{label:"$__timeFilter(timeColumn)",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__timeFilter(${0:"+this.defaultTimeField+"})"},documentation:{value:n}},{label:"$__from",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__from"},documentation:{value:"Built-in variable that returns the from value of the selected timerange in Grafana.\n\nExample: `where "+this.defaultTimeField+" > $__from` "}},{label:"$__to",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__to"},documentation:{value:"Built-in variable that returns the to value of the selected timerange in Grafana.\n\nExample: `where "+this.defaultTimeField+" < $__to` "}},{label:"$__timeInterval",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__timeInterval"},documentation:{value:"##### Built-in variable that returns an automatic time grain suitable for the current timerange.\n\nUsed with the bin() function - `bin("+this.defaultTimeField+", $__timeInterval)` \n\n[Grafana docs](http://docs.grafana.org/reference/templating/#the-interval-variable)"}}]:[]:[{label:"where $__timeFilter(timeColumn)",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"where \\$__timeFilter(${0:"+this.defaultTimeField+"})"},documentation:{value:n}}]:[]},e.prototype.getSignatureHelp=function(e,t,n){return"$__timeFilter("!==e.getValueInRange({startLineNumber:t.lineNumber,startColumn:t.column-14,endLineNumber:t.lineNumber,endColumn:t.column})?{}:{activeParameter:0,activeSignature:0,signatures:[{label:"$__timeFilter(timeColumn)",parameters:[{label:"timeColumn",documentation:"Default is "+this.defaultTimeField+" column. Datetime column to filter data using the selected date range. "}]}]}},e.prototype.onDidChangeCursorSelection=function(e){"modelChange"===e.source&&e.reason===monaco.editor.CursorChangeReason.RecoverFromMarkers&&(" "===this.getCharAt(e.selection.positionLineNumber,e.selection.positionColumn-1)&&this.triggerSuggestions())},e.prototype.triggerSuggestions=function(){var e,t=null===(e=this.codeEditor)||void 0===e?void 0:e.getContribution("editor.contrib.suggestController");if(t){var n=this.toSuggestionController(t);n._model.cancel(),setTimeout((function(){n._model.trigger(!0)}),10)}},e.prototype.getCharAt=function(e,t){var n,r=null===(n=this.codeEditor)||void 0===n?void 0:n.getModel();if(!r)return"";if(0===r.getLineCount()||r.getLineCount()<e)return"";var a=r.getLineContent(e);return a.length<t||t<1?"":a[t-1]},e}(),qe=n(6),Re=n.n(qe),Ie=function(e){function t(t){var n=e.call(this,t)||this;return n.getStyles=Object(_e.stylesFactory)((function(){return{editor:Object(Ae.css)(se||(se=m(["\n      width: 100%;\n      height: 350px;\n    "],["\n      width: 100%;\n      height: 350px;\n    "])))}})),n.styles=n.getStyles(),n.monacoRef=oe.a.createRef(),n.state={content:t.content},window.hasOwnProperty("monaco")?setTimeout((function(){n.initMonaco()}),1):window.System.import("/"+t.pluginBaseUrl+"/libs/monaco.min.js").then((function(){setTimeout((function(){n.initMonaco()}),1)})),n}return o(t,e),t.prototype.initMonaco=function(){var e=this;this.kustoCodeEditor=new Pe(this.monacoRef.current,this.props.defaultTimeField,this.props.getSchema,Re.a),this.kustoCodeEditor.initMonaco(this.props.content),this.kustoCodeEditor.addCommand(monaco.KeyMod.Shift|monaco.KeyCode.Enter,(function(){var t,n=null===(t=e.kustoCodeEditor)||void 0===t?void 0:t.getValue();e.props.onChange(n),e.props.onExecute()})),this.kustoCodeEditor.setOnDidChangeModelContent((function(){var t,n=null===(t=e.kustoCodeEditor)||void 0===t?void 0:t.getValue();e.props.onChange(n)})),window.onresize=function(){var t;null===(t=e.kustoCodeEditor)||void 0===t||t.resize()}},t.prototype.componentWillUnmount=function(){this.kustoCodeEditor&&this.kustoCodeEditor.disposeMonaco()},t.prototype.render=function(){return oe.a.createElement("div",{id:"content",tabIndex:0,className:this.styles.editor,ref:this.monacoRef})},t}(oe.a.Component),$e=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"}],Be={label:"ADX Time series",value:"time_series_adx_series"},Le=function(e){var t=e.onChangeFormat,n=Object(ae.useCallback)((function(e){e&&e.value&&t(e.value)}),[t]),r=Qe();return oe.a.createElement("div",{className:r.container},oe.a.createElement(_e.InlineFormLabel,{className:"query-keyword",width:6},"Format as"),oe.a.createElement(_e.Select,{options:e.includeAdxTimeFormat?d($e,[Be]):$e,value:e.format,onChange:n}))},Qe=Object(_e.stylesFactory)((function(){return{container:Object(Ae.css)(ce||(ce=m(["\n      display: flex;\n      flex-direction: row;\n      margin-right: 4px;\n    "],["\n      display: flex;\n      flex-direction: row;\n      margin-right: 4px;\n    "])))}})),Ge=function(e,t){var n=$e.find((function(t){return t.value===e}));return t&&Be.value&&Be.value===e?Be.value:n&&n.value?n.value:$e.length>0&&$e[0].value?$e[0].value:"time_series"},We=["//change this to create your own time series query","","<table name>","| where $__timeFilter(Timestamp)","// | summarize count() by <group by column>, bin(Timestamp, $__timeInterval)","// | order by Timestamp asc"].join("\n"),ze=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.onRawQueryChange=function(e){var n=Ge(t.props.query.resultFormat,!0);t.props.onChange(i(i({},t.props.query),{query:e,database:t.props.database,resultFormat:n}))},t.onChangeResultFormat=function(e){t.props.onChange(i(i({},t.props.query),{resultFormat:e}))},t}return o(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.query,r=t.datasource,a=t.lastQueryError,o=t.lastQuery,i=t.timeNotASC,l=t.schema,c=this.state,p=c.showLastQuery,d=c.showHelp,m=Ge(n.resultFormat,!0),f=Ue();return l?oe.a.createElement("div",null,oe.a.createElement(Ie,{defaultTimeField:"Timestamp",pluginBaseUrl:r.meta.baseUrl,content:n.query||We,getSchema:function(){return u(e,void 0,void 0,(function(){return s(this,(function(e){return[2,l]}))}))},onChange:this.onRawQueryChange,onExecute:this.props.onRunQuery}),oe.a.createElement("div",{className:f.toolbar},oe.a.createElement(Le,{includeAdxTimeFormat:!0,format:m,onChangeFormat:this.onChangeResultFormat}),oe.a.createElement("div",{className:"gf-form"},oe.a.createElement("label",{className:"gf-form-label query-keyword",onClick:function(){return e.setState({showHelp:!d})}},"Show Help ",oe.a.createElement(_e.Icon,{name:d?"angle-down":"angle-right"}))),oe.a.createElement("div",{className:"gf-form","ng-show":"ctrl.lastQuery"},oe.a.createElement("label",{className:"gf-form-label query-keyword",onClick:function(){return e.setState({showLastQuery:!p})}},"Raw Query ",oe.a.createElement(_e.Icon,{name:p?"angle-down":"angle-right"}))),oe.a.createElement("div",{className:"gf-form gf-form--grow"},oe.a.createElement("div",{className:"gf-form-label gf-form-label--grow"}))),p&&oe.a.createElement("div",{className:"gf-form"},oe.a.createElement("pre",{className:"gf-form-pre"},o)),a&&oe.a.createElement("div",{className:"gf-form"},oe.a.createElement("pre",{className:"gf-form-pre alert alert-error"},a)),i&&oe.a.createElement("div",{className:"gf-form"},oe.a.createElement("pre",{className:"gf-form-pre alert alert-warning"},"Data is not sorted ascending by Time. Recommend adding an order by clause.")),d&&oe.a.createElement("div",{className:"gf-form"},oe.a.createElement("pre",{className:"gf-form-pre alert alert-info"},'\n  Format as Table:\n  - Can return any set of columns.\n\n  Format as Time series:\n  - Requires exactly one column of Kusto type datetime. (tip: can use Kusto\'s project-away operator to remove columns).\n  - Requires at least one value column of a number type. Each value column is considered a metric.\n  - May optionally have one or more string columns. Each string column is considered as a key=value tag pair (where the key is the column name, and the value is the value of the column for each row).\n  - A time series is returned for each value column + unique set of string column values. Each series has name of valueColumnName { stringColumnName=columnValue, ... }. If there are no string columns in the request, the name will just be valueColumnName.\n  - Example Time Series Query:\n    AzureActivity\n      | where $__timeFilter()\n      | summarize count() by Category, bin(TimeGenerated, 60min)\n      | order by TimeGenerated asc\n\n  Format as ADX Time series:\n   - Used for queries that return Kusto\'s "time series" type, such as the make-series operator\n   - Must have a datetime column named "Timestamp"\n   - Example ADX Time series query:\n    let T = range Timestamp from $__timeFrom to $__timeTo step $__timeInterval * 4\n      | extend   Person = dynamic(["Torkel", "Daniel", "Kyle", "Sofia"]) \n      | extend   Place  = dynamic(["EU",     "EU",     "US",   "EU"]) \n      | mvexpand Person, Place\n      | extend   HatInventory = rand(5) \n      | project  Timestamp, tostring(Person), tostring(Place), HatInventory;\n    T | make-series avg(HatInventory) on Timestamp from $__timeFrom to $__timeTo step $__timeInterval * 4 by Person, Place;\n\n\n  Time Macros:\n  - $__timeFilter -&gt; TimeGenerated &ge; datetime(2018-06-05T18:09:58.907Z) and TimeGenerated &le; datetime(2018-06-05T20:09:58.907Z)\n  - $__timeFilter(datetimeColumn) -&gt;  datetimeColumn  &ge; datetime(2018-06-05T18:09:58.907Z) and datetimeColumn &le; datetime(2018-06-05T20:09:58.907Z)\n  - $__timeFrom -&gt;  datetime(2018-06-05T18:09:58.907Z) [the start time of the query]\n  - $__timeTo -&gt; datetime(2018-06-05T20:09:58.907Z) [the end time of the query]\n  - $__timeInterval -&gt; 5000ms [Grafana\'s recommended bin size based on the timespan of the query, in ms]\n\n  Templating Macros:\n  - $__escapeMulti($myTemplateVar) -&gt; $myTemplateVar should be a multi-value template variables that contains illegal characters\n  - $__contains(aColumn, $myTemplateVar) -&gt; aColumn in ($myTemplateVar)\n    If using the All option, then check the Include All Option checkbox and in the Custom all value field type in: all. If All is chosen -&gt; 1 == 1\n\n  Macro Examples:\n  - ¡ where $__timeFilter()\n  - | where TimeGenerated &ge; $__timeFrom() and TimeGenerated &le; $__timeTo()\n  - | summarize count() by Category, bin(TimeGenerated, $__timeInterval)'))):null},t}(ae.PureComponent),Ue=Object(_e.stylesFactory)((function(){return{toolbar:Object(Ae.css)(pe||(pe=m(["\n      display: flex;\n      flex-direction: row;\n      margin-top: 4px;\n    "],["\n      display: flex;\n      flex-direction: row;\n      margin-top: 4px;\n    "])))}})),Ke=function(e){return oe.a.createElement("div",{className:"gf-form"},oe.a.createElement(_e.InlineFormLabel,{className:"query-keyword",width:12},e.label),e.children)},He=function(e){return{name:e.value,type:e.type}},Ze=function(e){var t=e.value,n=e.fields,r=e.allowCustom,a=e.placeholder,o=e.templateVariableOptions,l=e.onChange,u=p(Object(ae.useState)(null),2),s=u[0],c=u[1],m=Xe(),f=Je(n),v=Object(ae.useMemo)((function(){return f.find((function(e){return e.value===(null==t?void 0:t.name)}))}),[f,t]),h=Object(ae.useMemo)((function(){return et(f,o)}),[f,o]),y=Ye(e,t,c),g=Object(ae.useCallback)((function(){!v&&s&&l(i({},s)),c(null)}),[l,c,s,v]);return oe.a.createElement("div",{className:m.container},oe.a.createElement(_e.AsyncSelect,{width:30,onChange:y,value:v,defaultOptions:o?d([o],f):f,loadOptions:h,placeholder:a,menuPlacement:"bottom",allowCustomValue:r,backspaceRemovesValue:!0,isClearable:!0,onCloseMenu:g}))},Xe=Object(_e.stylesFactory)((function(){return{container:Object(Ae.css)(de||(de=m(["\n      margin-right: 4px;\n    "],["\n      margin-right: 4px;\n    "])))}})),Je=function(e){return Object(ae.useMemo)((function(){return e?e.map((function(e){var t;return{label:null!==(t=e.label)&&void 0!==t?t:e.value,value:e.value,type:e.type}})):[]}),[e])},Ye=function(e,t,n){var r=e.fields,a=e.allowCustom,o=e.templateVariableOptions,i=e.onChange;return Object(ae.useCallback)((function(e){var l;if(!e||"string"!=typeof e.value&&t){var u=j.String;return i({name:null,type:u}),void(t&&n(t))}var s=e.value,c=r.find((function(e){return e.value===s}));c||(c=null===(l=null==o?void 0:o.options)||void 0===l?void 0:l.find((function(e){return e.value===s}))),!c&&s&&a&&(c={value:s,type:j.String}),c&&i({name:c.value,type:c.type})}),[r,i,o,a,t,n])},et=function(e,t){return function(n){return u(void 0,void 0,void 0,(function(){var r,a,o,i,l;return s(this,(function(u){return r=n.toLowerCase(),a=t?d([t],e):e,o=a.filter((function(e){var t;return null===(t=e.label)||void 0===t?void 0:t.toLowerCase().startsWith(r)})),i=a.filter((function(e){var t;return-1!==(null===(t=e.label)||void 0===t?void 0:t.toLowerCase().indexOf(r,1))})),l=o.concat(i),[2,d(new Set(l))]}))}))}},tt=function(e){return function(t){e({type:f.Property,property:t})}},nt=function(){function e(){}return e.prototype.build=function(){return e={defaultValue:this.buildFieldExpression()},function(t){var n,r=t.onChange,a=null!==(n=t.value)&&void 0!==n?n:e.defaultValue;return k(a)?oe.a.createElement(Ke,{label:t.label},oe.a.createElement(Ze,{fields:t.fields,templateVariableOptions:t.templateVariableOptions,onChange:tt(r),value:a.property,allowCustom:t.allowCustom}),t.children):null};var e},e.prototype.buildFieldExpression=function(){return{type:f.Property,property:{name:"",type:j.String}}},e}(),rt=function(e){function t(t){var n=e.call(this,t)||this;return n.onCreate=function(e){if(e){var t=d(n.props.values,[e]);n.props.onChange({value:t,name:n.props.operator.value})}},n.onChange=function(e){Array.isArray(e)&&n.props.onChange({value:e.map((function(e){return e.value})),name:n.props.operator.value})},n.getSuggestions=function(e){return u(n,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.setState({isLoading:!0}),[4,this.props.getSuggestions(e)];case 1:return t=n.sent(),this.setState({defaultOptions:d([this.props.templateVariableOptions],t),isLoading:!1}),[2,t]}}))}))},n.state={defaultOptions:[t.templateVariableOptions],isLoading:!1},n}return o(t,e),t.prototype.render=function(){var e=this,t=(this.props.values||[]).map((function(e){return{label:e,value:e}}));return oe.a.createElement(_e.AsyncMultiSelect,{width:30,placeholder:"Start typing to add filters...",loadOptions:this.getSuggestions,onOpenMenu:function(){return e.getSuggestions("")},defaultOptions:this.state.defaultOptions,isLoading:this.state.isLoading,value:t,onChange:this.onChange,onCreateOption:this.onCreate,noOptionsMessage:"No options found",isClearable:!0})},t}(ae.PureComponent),at=function(e){function t(t){var n=e.call(this,t)||this;return n.onChange=function(e){null!==e?n.props.onChange({value:""+e.value,name:n.props.operator.value}):n.props.onChange({value:"",name:n.props.operator.value})},n.onCreate=function(e){e&&n.props.onChange({value:e,name:n.props.operator.value})},n.getSuggestions=function(e){return u(n,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.setState({isLoading:!0}),[4,this.props.getSuggestions(e)];case 1:return t=n.sent(),this.setState({defaultOptions:d([this.props.templateVariableOptions],t),isLoading:!1}),[2,t]}}))}))},n.state={defaultOptions:[t.templateVariableOptions],isLoading:!1},n}return o(t,e),t.prototype.render=function(){var e=this,t=this.props.value,n=t?{label:t,value:t}:void 0;return oe.a.createElement(_e.AsyncSelect,{width:30,placeholder:"Start typing to add filters...",loadOptions:this.getSuggestions,onOpenMenu:function(){return e.getSuggestions(null!=t?t:"")},defaultOptions:this.state.defaultOptions,isLoading:this.state.isLoading,value:n,onChange:this.onChange,onCreateOption:this.onCreate,allowCustomValue:!0,backspaceRemovesValue:!0,isClearable:!0,noOptionsMessage:"No options found"})},t}(ae.PureComponent),ot=[{value:!0,label:"True"},{value:!1,label:"False"}],it=function(e){var t=Object(ae.useCallback)((function(t){t&&"boolean"==typeof t.value&&e.onChange({name:e.operator.value,value:t.value})}),[e]);return oe.a.createElement(_e.Select,{width:15,options:ot,value:e.value,onChange:t,menuPlacement:"bottom"})},lt=function(e,t,n,r){if(t.multipleValues)return Array.isArray(n)?ut(e,n):ut(e,[n]);var a=st(e,n);return h.a.isUndefined(a)?r:a},ut=function(e,t){return t.reduce((function(t,n){var r=st(e,n);return h.a.isUndefined(r)||t.push(r),t}),[])},st=function(e,t){switch(e.type){case j.Boolean:return pt(t,!1);case j.Number:return ct(t,0);default:return}},ct=function(e,t){return h.a.isNumber(e)?h.a.toNumber(e):"boolean"==typeof e?e?1:0:t},pt=function(e,t){if("boolean"==typeof e)return e;if("string"==typeof e){var n=h.a.toLower(h.a.trim(e));return!!h.a.startsWith(n,"t")||!!h.a.startsWith(n,"1")}return"number"==typeof e?e>0:t},dt=function(e){var t,n=p(Object(ae.useState)(null!==(t=e.value)&&void 0!==t?t:""),2),r=n[0],a=n[1],o=e.onChange,i=e.operator.value,l=Object(ae.useCallback)((function(e){a(e.currentTarget.value)}),[a]),u=Object(ae.useCallback)((function(e){o({name:i,value:e.currentTarget.value})}),[o,i]);return oe.a.createElement(_e.Input,{width:30,value:r,onChange:l,onBlur:u})},mt=function(e){var t,n=p(Object(ae.useState)(String(null!==(t=e.value)&&void 0!==t?t:0)),2),r=n[0],a=n[1],o=e.onChange,i=e.operator.value,l=Object(ae.useCallback)((function(e){a(e.currentTarget.value)}),[a]),u=Object(ae.useCallback)((function(e){o({name:i,value:ft(e.currentTarget.value)})}),[o,i]);return oe.a.createElement(_e.Input,{width:30,value:r,onChange:l,onBlur:u})},ft=function(e){return e?isNaN(e)?0:parseInt(e,10):0},vt=function(e){return e.booleanValues?{name:e.value,value:!1}:e.multipleValues?{name:e.value,value:[]}:{name:e.value,value:""}},ht=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChangeOperator=function(e){if(e&&e.value){var n=t.props,r=n.property,a=n.value,o=t.props.operators.find((function(t){return t.value===e.value}));if(!o||!r)return;if(!a)return void t.props.onChange(vt(o));var i=vt(o),l=i.value,u=a.value;i.value=lt(r,o,u,l),t.props.onChange(i)}},t.onChangeValue=function(e){t.props.onChange(e)},t}return o(t,e),t.prototype.render=function(){var e=this.props,t=e.operators,n=e.value,r=e.getSuggestions,a=e.templateVariableOptions,o=e.property,u=gt(),s=t.find((function(e){return e.value===(null==n?void 0:n.name)}));return oe.a.createElement(oe.a.Fragment,null,oe.a.createElement("div",{className:u.container},oe.a.createElement(_e.Select,{isSearchable:!0,options:t,value:null==s?void 0:s.value,onChange:this.onChangeOperator,menuPlacement:"bottom",renderControl:oe.a.forwardRef((function(e,t){e.value,e.isOpen,e.invalid;var n=l(e,["value","isOpen","invalid"]);return oe.a.createElement(_e.Button,i({ref:t},n,{variant:"secondary"}),(null==s?void 0:s.label)||(null==s?void 0:s.value)||"?")}))})),yt(s,n,this.onChangeValue,r,a,null==o?void 0:o.type))},t}(ae.PureComponent),yt=function(e,t,n,r,a,o){var i;if(!e)return null;var l=gt();return function(e,t){return t===j.DateTime&&"string"==typeof(null==e?void 0:e.value)}(t,o)?oe.a.createElement("div",{className:l.container},oe.a.createElement(dt,{operator:e,value:null==t?void 0:t.value,onChange:n})):function(e,t){return t===j.Number&&"number"==typeof(null==e?void 0:e.value)}(t,o)?oe.a.createElement("div",{className:l.container},oe.a.createElement(mt,{operator:e,value:null==t?void 0:t.value,onChange:n})):!e.multipleValues||!M(t)&&t?!e.booleanValues||!function(e){return"boolean"==typeof(null==e?void 0:e.value)}(t)&&t?e.multipleValues||!function(e){return!M(e)}(t)&&t?null:oe.a.createElement("div",{className:l.container},oe.a.createElement(at,{operator:e,value:null==t?void 0:t.value,onChange:n,getSuggestions:r,templateVariableOptions:a})):oe.a.createElement("div",{className:l.container},oe.a.createElement(it,{operator:e,value:null==t?void 0:t.value,onChange:n})):oe.a.createElement("div",{className:l.container},oe.a.createElement(rt,{operator:e,values:null!==(i=null==t?void 0:t.value)&&void 0!==i?i:[],onChange:n,getSuggestions:r,templateVariableOptions:a}))},gt=Object(_e.stylesFactory)((function(){return{container:Object(Ae.css)(me||(me=m(["\n      margin-right: 4px;\n      /* when Grafanas Select has labels */\n      div[class*='grafana-select-option-description'] {\n        white-space: nowrap;\n      }\n      /* fallback until Grafanas Select has labels */\n      [aria-label*='Select options menu'] {\n        div {\n          div {\n            div {\n              div {\n                div {\n                  white-space: nowrap;\n                }\n              }\n            }\n          }\n        }\n      }\n    "],["\n      margin-right: 4px;\n      /* when Grafanas Select has labels */\n      div[class*='grafana-select-option-description'] {\n        white-space: nowrap;\n      }\n      /* fallback until Grafanas Select has labels */\n      [aria-label*='Select options menu'] {\n        div {\n          div {\n            div {\n              div {\n                div {\n                  white-space: nowrap;\n                }\n              }\n            }\n          }\n        }\n      }\n    "])))}})),bt=n(8),wt=n.n(bt),xt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={operators:[]},t.componentDidMount=function(){var e,n=null===(e=t.props.value)||void 0===e?void 0:e.property;n&&t.updateOperators(n)},t.updateOperators=function(e){var n,r,a=[];try{for(var o=c(t.props.operators),i=o.next();!i.done;i=o.next()){var l=i.value;l.supportTypes.includes(e.type)&&a.push(l)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return t.setState({operators:a}),a},t.onFieldChanged=function(e){var n,r,a,o=i(i({},t.props.value),{property:e}),l=t.updateOperators(e),u=null===(n=o.operator)||void 0===n?void 0:n.name,s=l.find((function(e){return e.value===u}));if(l.length&&!s){o.operator=vt(l[0]);var c=o.operator.value,p=null===(r=t.props.value)||void 0===r?void 0:r.operator.value;o.operator.value=lt(o.property,l[0],p,c)}if(!s)return t.props.onChange(o);o.operator=vt(s);var d=o.operator.value,m=null===(a=t.props.value)||void 0===a?void 0:a.operator.value;o.operator.value=lt(o.property,s,m,d),t.props.onChange(o)},t.onOperatorChange=function(e){t.props.onChange(i(i({},t.props.value),{operator:e}))},t.getSuggestions=wt()((function(e){return u(t,void 0,void 0,(function(){var t,n,r,a;return s(this,(function(o){switch(o.label){case 0:return this.props.value?(t=Ot(this.props.value.property,e),[4,this.props.getSuggestions(t)]):[2,[]];case 1:return n=o.sent(),Array.isArray(null===(a=this.props.templateVariableOptions)||void 0===a?void 0:a.options)&&(r=this.props.templateVariableOptions.options.filter((function(t){return"string"==typeof(null==t?void 0:t.value)&&t.value.indexOf(e)>-1})),Array.prototype.push.apply(n,r)),[2,n]}}))}))}),800,{leading:!1}),t}return o(t,e),t.prototype.render=function(){var e=this.props,t=e.value,n=e.fields,r=e.templateVariableOptions,a=this.state.operators,o=Ct(),i=(null==t?void 0:t.operator)||(null==t?void 0:t.property);return oe.a.createElement("div",{className:o.container},oe.a.createElement(Ze,{value:null==t?void 0:t.property,fields:n,templateVariableOptions:r,onChange:this.onFieldChanged,placeholder:"Choose column..."}),i&&oe.a.createElement(ht,{value:null==t?void 0:t.operator,operators:a,onChange:this.onOperatorChange,getSuggestions:this.getSuggestions,property:null==t?void 0:t.property,templateVariableOptions:r}))},t}(ae.PureComponent),Ct=Object(_e.stylesFactory)((function(){return{container:Object(Ae.css)(fe||(fe=m(["\n      display: flex;\n      flex-direction: row;\n    "],["\n      display: flex;\n      flex-direction: row;\n    "])))}})),Ot=function(e,t){return t?{type:f.Operator,property:e,operator:{name:"contains",value:t}}:{type:f.Operator,property:e,operator:{name:"isnotempty",value:t}}},Et=function(e){var t=e.onChange,n=e.children,r=e.value,a=e.id,o=Object(ae.useCallback)((function(e,n){var a=r.expressions,o=Array.from(a);n?o.splice(e,1,n):o.splice(e,1),t(i(i({},r),{expressions:o}))}),[n,t,r]);if(!(null==r?void 0:r.expressions))return null;var l=r.expressions.length;return oe.a.createElement(oe.a.Fragment,null,r.expressions.map((function(e,t){return oe.a.createElement(oe.a.Fragment,{key:a+"-"+t},n({index:t,value:e,onChange:function(e){return o(t,e)},onAdd:function(e){return o(l,e)},onRemove:function(){return o(t)}}))})))},St=Object(_e.stylesFactory)((function(){var e=Object(Ae.css)(ve||(ve=m(["\n    display: flex;\n    flex-direction: row;\n  "],["\n    display: flex;\n    flex-direction: row;\n  "])));return{container:Object(Ae.css)(he||(he=m(["\n      display: flex;\n      flex-direction: column;\n    "],["\n      display: flex;\n      flex-direction: column;\n    "]))),row:e,rowWithSpacing:Object(Ae.css)(ye||(ye=m(["\n      ","\n      margin-top: 4px;\n    "],["\n      ","\n      margin-top: 4px;\n    "])),e),spacing:Object(Ae.css)(ge||(ge=m(["\n      margin-right: 4px;\n    "],["\n      margin-right: 4px;\n    "])))}})),jt=function(){function e(e,t){this.value=e,this.operators=t,this.label=e,this.types=[],this.description="",this.multiple=!1,this.bool=!1}return e.prototype.withLabel=function(e){return this.label=e,this},e.prototype.withDescription=function(e){return this.description=e,this},e.prototype.supportTypes=function(e){return this.types=e,this},e.prototype.multipleValues=function(e){return this.multiple=e,this},e.prototype.booleanValues=function(e){return this.bool=e,this},e.prototype.add=function(){this.operators.push({value:this.value,supportTypes:this.types,label:this.label,description:this.description,multipleValues:this.multiple,booleanValues:this.bool})},e}(),Tt=function(){function e(){this.operators=[]}return e.prototype.withOperators=function(e){var t=this;return e((function(e){return new jt(e,t.operators)})),this},e.prototype.withMultipleRows=function(e){return this},e.prototype.build=function(){return e={operators:this.operators,defaultValue:this.buildOperatorExpression()},function(t){var n,r,a=St();return 0===(null===(r=null===(n=t.value)||void 0===n?void 0:n.expressions)||void 0===r?void 0:r.length)?oe.a.createElement(Ke,{label:t.label},oe.a.createElement(_e.Button,{variant:"secondary",onClick:function(){var n=i(i({},t.value),{expressions:[{type:f.Or,expressions:[e.defaultValue]}]});t.onChange(n)},icon:"plus"})):oe.a.createElement(Et,{id:"filter-and",value:t.value,onChange:t.onChange},(function(n){var r,o;return A(n.value)?0===(null===(o=null===(r=n.value)||void 0===r?void 0:r.expressions)||void 0===o?void 0:o.length)?n.index>0?null:oe.a.createElement(Ke,{label:t.label},oe.a.createElement(_e.Button,{variant:"secondary",onClick:function(){var t={type:f.Or,expressions:[e.defaultValue]};n.onChange(t)},icon:"plus"})):oe.a.createElement(Ke,{label:t.label},oe.a.createElement("div",{className:a.container},oe.a.createElement(Et,{id:"filter-or",value:n.value,onChange:n.onChange},(function(r){if(!N(r.value))return console.log("invalid fieldandoperator-expression"),null;var o,u=0===r.index,s=u?a.row:a.rowWithSpacing;return oe.a.createElement("div",{className:s},!u&&oe.a.createElement(_e.InlineFormLabel,{className:"query-keyword",width:3},"or"),oe.a.createElement(xt,{value:r.value,operators:e.operators,fields:t.fields,templateVariableOptions:t.templateVariableOptions,onChange:r.onChange,getSuggestions:(o=n.index+"-"+r.index,function(e){return t.getSuggestions(o,e)})}),oe.a.createElement("div",{className:a.spacing},oe.a.createElement(_e.Button,{variant:"secondary",onClick:r.onRemove,icon:"minus"})),u&&oe.a.createElement(_e.Select,{isSearchable:!0,options:[{value:"append-row",label:"OR - include another option"},{value:"new-row",label:'AND - add a new "'+t.label+'" clause'}],onChange:function(t){return"append-row"===(null==t?void 0:t.value)?r.onAdd(e.defaultValue):"new-row"===(null==t?void 0:t.value)?n.onAdd({type:f.Or,expressions:[e.defaultValue]}):void 0},menuPlacement:"bottom",renderControl:oe.a.forwardRef((function(e,t){e.value,e.isOpen,e.invalid;var n=l(e,["value","isOpen","invalid"]);return oe.a.createElement(_e.Button,i({ref:t},n,{variant:"secondary",icon:"plus"}))}))}))})))):null}))};var e},e.prototype.buildOperatorExpression=function(){var e=this.operators[0];return{type:f.Operator,property:this.buildFieldExpression(),operator:vt(e)}},e.prototype.buildFieldExpression=function(){return{name:"",type:j.String}},e}(),Ft=function(e){var t,n=p(Object(ae.useState)(null!==(t=e.value)&&void 0!==t?t:""),2),r=n[0],a=n[1],o=Object(ae.useCallback)((function(e){e&&e.currentTarget&&a(e.currentTarget.value)}),[a]),i=Object(ae.useCallback)((function(){e.onChange({type:f.FunctionParameter,fieldType:e.fieldType,value:r,name:e.name})}),[r,e]);return oe.a.createElement(_e.Input,{width:20,value:r,placeholder:e.description,onChange:o,onBlur:i})},Vt=function(e){var t,n,r,a,o=e.value,i=e.functions,l=e.onChange,u=p(Object(ae.useState)(null===(t=e.value)||void 0===t?void 0:t.property),2),s=u[0],c=u[1],d=p(Object(ae.useState)(null===(n=e.value)||void 0===n?void 0:n.reduce),2),m=d[0],v=d[1],h=p(Object(ae.useState)(null===(r=e.value)||void 0===r?void 0:r.parameters),2),y=h[0],g=h[1],b=Dt(m,e.functions),w=kt(),x=Object(ae.useCallback)((function(e){var t;if(c(e),!(null===(t=null==o?void 0:o.reduce)||void 0===t?void 0:t.name)){var n=i.find((function(e){return"avg"===e.value}));n||(n=i[0]),v({name:n.value,type:j.Function})}}),[c,o,i]),C=Object(ae.useCallback)((function(e){v(e)}),[v]),O=Object(ae.useCallback)((function(e){g(e)}),[g]);Object(ae.useEffect)((function(){if(s&&m){var e={type:f.Reduce,property:s,reduce:m,parameters:y};l(e)}}),[s,m,y]);var E=Nt(m,e.functions);return oe.a.createElement("div",{className:w.container},oe.a.createElement(Ze,{value:m,fields:e.functions,onChange:C,placeholder:"Choose aggregation function..."}),E.length>0&&oe.a.createElement("div",{className:w.params},E.map((function(t){var n,r,a;return oe.a.createElement(Ft,{key:t.name,name:t.name,value:null===(a=null===(r=null===(n=e.value)||void 0===n?void 0:n.parameters)||void 0===r?void 0:r.find((function(e){return e.name===t.name})))||void 0===a?void 0:a.value,description:t.description,fieldType:t.type,onChange:function(e){return O([e])}})}))),b&&oe.a.createElement(oe.a.Fragment,null,oe.a.createElement(_e.InlineFormLabel,{width:2,className:"query-keyword"},null!==(a=e.label)&&void 0!==a?a:"of"),oe.a.createElement(Ze,{value:s,fields:e.fields,templateVariableOptions:e.templateVariableOptions,onChange:x,placeholder:"Choose column..."})))},kt=Object(_e.stylesFactory)((function(){return{container:Object(Ae.css)(be||(be=m(["\n      display: flex;\n      flex-direction: row;\n    "],["\n      display: flex;\n      flex-direction: row;\n    "]))),params:Object(Ae.css)(we||(we=m(["\n      margin-right: 4px;\n    "],["\n      margin-right: 4px;\n    "])))}})),Nt=function(e,t){if(!e)return[];var n=t.find((function(t){return t.value===e.name}));return(null==n?void 0:n.parameters)||[]},Dt=function(e,t){return Object(ae.useMemo)((function(){var n,r,a;if(!e)return null===(r=null===(n=t[0])||void 0===n?void 0:n.applyOnField)||void 0===r||r;var o=t.find((function(t){return t.value===e.name}));return null===(a=null==o?void 0:o.applyOnField)||void 0===a||a}),[t,e])},Mt=Object(_e.stylesFactory)((function(){var e=Object(Ae.css)(xe||(xe=m(["\n    display: flex;\n    flex-direction: row;\n  "],["\n    display: flex;\n    flex-direction: row;\n  "])));return{container:Object(Ae.css)(Ce||(Ce=m(["\n      display: flex;\n      flex-direction: column;\n    "],["\n      display: flex;\n      flex-direction: column;\n    "]))),row:e,rowWithSpacing:Object(Ae.css)(Oe||(Oe=m(["\n      ","\n      margin-top: 4px;\n    "],["\n      ","\n      margin-top: 4px;\n    "])),e),spacing:Object(Ae.css)(Ee||(Ee=m(["\n      margin-right: 4px;\n    "],["\n      margin-right: 4px;\n    "])))}})),_t=function(){function e(e,t){this.value=e,this.functions=t,this.appliedOnField=!0,this.parameters=[],this.label=e}return e.prototype.withLabel=function(e){return this.label=e,this},e.prototype.withParameter=function(e,t,n){return this.parameters.push({name:e,type:t,description:n}),this},e.prototype.isAppliedOnField=function(e){return this.appliedOnField=e,this},e.prototype.add=function(){this.functions.push({value:this.value,label:this.label,type:j.Function,parameters:this.parameters,applyOnField:this.appliedOnField})},e}(),At=function(){function e(){this.functions=[]}return e.prototype.withMultipleRows=function(e){return this},e.prototype.withFunctions=function(e){var t=this;return e((function(e){return new _t(e,t.functions)})),this},e.prototype.build=function(){return e={functions:this.functions,defaultValue:this.buildReduceExpression()},function(t){var n=Mt();return 0===t.value.expressions.length?oe.a.createElement(Ke,{label:t.label},oe.a.createElement(_e.Button,{variant:"secondary",onClick:function(){var n=i(i({},t.value),{expressions:[e.defaultValue]});t.onChange(n)},icon:"plus"})):oe.a.createElement(Ke,{label:t.label},oe.a.createElement("div",{className:n.container},oe.a.createElement(Et,{id:"reduce",onChange:t.onChange,value:t.value},(function(r){if(!V(r.value))return null;var a=0===r.index,o=a?n.row:n.rowWithSpacing;return oe.a.createElement("div",{className:o},oe.a.createElement(Vt,{onChange:r.onChange,value:r.value,templateVariableOptions:t.templateVariableOptions,fields:t.fields,functions:e.functions}),oe.a.createElement(_e.Button,{className:n.spacing,variant:"secondary",onClick:r.onRemove,icon:"minus"}),a&&oe.a.createElement(_e.Button,{variant:"secondary",onClick:function(){return r.onAdd(e.defaultValue)},icon:"plus"}))}))))};var e},e.prototype.buildReduceExpression=function(){return{type:f.Reduce,property:this.buildProperty(j.String),reduce:this.buildProperty(j.Function)}},e.prototype.buildProperty=function(e){return{name:"",type:e}},e}(),Pt=function(e){var t,n,r=e.intervals,a=e.onChange,o=p(Object(ae.useState)(null===(t=e.value)||void 0===t?void 0:t.property),2),i=o[0],l=o[1],u=p(Object(ae.useState)(null===(n=e.value)||void 0===n?void 0:n.interval),2),s=u[0],c=u[1],d=qt(),m=Object(ae.useCallback)((function(e){l(e),e.type===j.DateTime&&c({type:j.Interval,name:r[0].value})}),[l,r]),v=Object(ae.useCallback)((function(e){c(e)}),[c]);return Object(ae.useEffect)((function(){if(i){var e={type:f.GroupBy,property:i,interval:s};a(e)}}),[i,s]),oe.a.createElement("div",{className:d.container},oe.a.createElement(Ze,{value:i,fields:e.fields,templateVariableOptions:e.templateVariableOptions,onChange:m,placeholder:"Choose column..."}),(null==i?void 0:i.type)===j.DateTime&&oe.a.createElement(Ze,{value:s,fields:e.intervals,templateVariableOptions:e.templateVariableOptions,onChange:v,placeholder:"Choose interval",allowCustom:!0}))},qt=Object(_e.stylesFactory)((function(){return{container:Object(Ae.css)(Se||(Se=m(["\n      display: flex;\n      flex-direction: row;\n    "],["\n      display: flex;\n      flex-direction: row;\n    "])))}})),Rt=Object(_e.stylesFactory)((function(){var e=Object(Ae.css)(je||(je=m(["\n    display: flex;\n    flex-direction: row;\n  "],["\n    display: flex;\n    flex-direction: row;\n  "])));return{container:Object(Ae.css)(Te||(Te=m(["\n      display: flex;\n      flex-direction: column;\n    "],["\n      display: flex;\n      flex-direction: column;\n    "]))),row:e,rowWithSpacing:Object(Ae.css)(Fe||(Fe=m(["\n      ","\n      margin-top: 4px;\n    "],["\n      ","\n      margin-top: 4px;\n    "])),e),spacing:Object(Ae.css)(Ve||(Ve=m(["\n      margin-right: 4px;\n    "],["\n      margin-right: 4px;\n    "])))}})),It=function(){function e(e,t){this.value=e,this.intervals=t,this.label=e}return e.prototype.withLabel=function(e){return this.label=e,this},e.prototype.add=function(){this.intervals.push({value:this.value,label:this.label,type:j.Interval})},e}(),$t=function(){function e(){this.intervals=[]}return e.prototype.withMultipleRows=function(e){return this},e.prototype.withIntervals=function(e){var t=this;return e((function(e){return new It(e,t.intervals)})),this},e.prototype.build=function(){return e={intervals:this.intervals,defaultValue:this.buildGroupByExpressions()},function(t){var n=Rt();return 0===t.value.expressions.length?oe.a.createElement(Ke,{label:t.label},oe.a.createElement(_e.Button,{variant:"secondary",onClick:function(){var n=i(i({},t.value),{expressions:[e.defaultValue]});t.onChange(n)},icon:"plus"})):oe.a.createElement(Ke,{label:t.label},oe.a.createElement("div",{className:n.container},oe.a.createElement(Et,{id:"group-by",onChange:t.onChange,value:t.value},(function(r){if(!D(r.value))return null;var a=0===r.index,o=a?n.row:n.rowWithSpacing;return oe.a.createElement("div",{className:o},oe.a.createElement(Pt,{onChange:r.onChange,value:r.value,templateVariableOptions:t.templateVariableOptions,fields:t.fields,intervals:e.intervals}),oe.a.createElement(_e.Button,{className:n.spacing,variant:"secondary",onClick:r.onRemove,icon:"minus"}),a&&oe.a.createElement(_e.Button,{variant:"secondary",onClick:function(){return r.onAdd(e.defaultValue)},icon:"plus"}))}))))};var e},e.prototype.buildGroupByExpressions=function(){return{type:f.GroupBy,property:{name:"",type:j.String}}},e}(),Bt=function(e){return e.build()}(new nt),Lt=function(e){return e(new Tt)}((function(e){return e.withOperators((function(e){e("==").supportTypes([j.String,j.Number,j.DateTime]).withDescription("equal to").add(),e("==").supportTypes([j.Boolean]).withDescription("equal to").booleanValues(!0).add(),e("!=").supportTypes([j.String,j.Number,j.DateTime]).withDescription("not equal to").add(),e("!=").supportTypes([j.Boolean]).withDescription("not equal to").booleanValues(!0).add(),e(">").supportTypes([j.Number,j.DateTime]).withDescription("greater than").add(),e("<").supportTypes([j.Number,j.DateTime]).withDescription("less than").add(),e("=~").supportTypes([j.String]).withDescription("equal to (case-insensitive)").add(),e("!~").supportTypes([j.String]).withDescription("not equal to (case-insensitive)").add(),e("in").supportTypes([j.String]).withDescription("in (case-sensitive)").multipleValues(!0).add(),e("in~").supportTypes([j.String]).withDescription("in (case-insensitive)").multipleValues(!0).add(),e("!in").supportTypes([j.String]).withDescription("not in (case-sensitive)").multipleValues(!0).add(),e("!in~").supportTypes([j.String]).withDescription("not in (case-insensitive)").multipleValues(!0).add(),e("contains").supportTypes([j.String]).withDescription("contains substring").multipleValues(!1).add(),e("!contains").supportTypes([j.String]).withDescription("does not contain substring").multipleValues(!1).add(),e("contains_cs").supportTypes([j.String]).withDescription("contains substring (case-sensitive)").multipleValues(!1).add(),e("!contains_cs").supportTypes([j.String]).withDescription("does not contain substring (case-sensitive)").multipleValues(!1).add(),e("endswith").supportTypes([j.String]).withDescription("ends with").multipleValues(!1).add(),e("!endswith").supportTypes([j.String]).withDescription("does not end with").multipleValues(!1).add(),e("endswith_cs").supportTypes([j.String]).withDescription("ends with (case-sensitive)").multipleValues(!1).add(),e("!endswith_cs").supportTypes([j.String]).withDescription("does not end with (case-sensitive)").multipleValues(!1).add(),e("startswith").supportTypes([j.String]).withDescription("starts with").multipleValues(!1).add(),e("!startsswith").supportTypes([j.String]).withDescription("does not start with").multipleValues(!1).add(),e("startswith_cs").supportTypes([j.String]).withDescription("starts with (case-sensitive)").multipleValues(!1).add(),e("!startswith_cs").supportTypes([j.String]).withDescription("does not start with (case-sensitive)").multipleValues(!1).add(),e("matches regex").supportTypes([j.String]).withDescription("regex string matching").multipleValues(!1).add(),e("has_any").supportTypes([j.String]).withDescription("any provided values matching").multipleValues(!0).add(),e("has").supportTypes([j.String]).withDescription("match if whole term exists in column").multipleValues(!1).add(),e("!has").supportTypes([j.String]).withDescription("match if whole term not exists in column").multipleValues(!1).add()})).withMultipleRows(!0).build()})),Qt=function(e){return e(new At)}((function(e){return e.withFunctions((function(e){e("sum").withLabel("Sum").add(),e("avg").withLabel("Avg").add(),e("count").isAppliedOnField(!1).withLabel("Count").add(),e("dcount").withLabel("Dcount").add(),e("max").withLabel("Max").add(),e("min").withLabel("Min").add(),e("percentile").withLabel("Percentile").withParameter("percentileParam",j.Number,"percentile constant").add()})).withMultipleRows(!0).build()})),Gt=function(e){return e(new $t)}((function(e){return e.withIntervals((function(e){e("$__timeInterval").withLabel("auto").add(),e("1m").withLabel("1 minute").add(),e("5m").withLabel("5 minutes").add(),e("15m").withLabel("15 minutes").add(),e("30m").withLabel("30 minutes").add(),e("1h").withLabel("1 hour").add(),e("6h").withLabel("6 hours").add(),e("12h").withLabel("12 hours").add(),e("1d").withLabel("1 day").add()})).withMultipleRows(!0).build()})),Wt=function(){function e(e){this.datasource=e}return e.prototype.createCacheKey=function(e){return"AdxSchemaResolver."+this.datasource.id+"."+e},e.prototype.getDatabases=function(){return u(this,void 0,Promise,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,this.datasource.getSchema()];case 1:return e=t.sent(),[2,Object.keys(e.Databases).map((function(t){return e.Databases[t]}))]}}))}))},e.prototype.getTablesForDatabase=function(e){return u(this,void 0,Promise,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return[4,this.getDatabases()];case 1:return t=r.sent(),(n=t.find((function(t){return t.Name===e})))?[2,Object.keys(n.Tables).map((function(e){return n.Tables[e]}))]:[2,[]]}}))}))},e.prototype.getViewsForDatabase=function(e){return u(this,void 0,Promise,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return[4,this.getDatabases()];case 1:return t=r.sent(),(n=t.find((function(t){return t.Name===e})))?[2,Object.keys(n.MaterializedViews).map((function(e){return n.MaterializedViews[e]}))]:[2,[]]}}))}))},e.prototype.getFunctionsForDatabase=function(e){return u(this,void 0,Promise,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return[4,this.getDatabases()];case 1:return t=r.sent(),(n=t.find((function(t){return t.Name===e})))?[2,Object.keys(n.Functions).map((function(e){return n.Functions[e]}))]:[2,[]]}}))}))},e.prototype.getColumnsForTable=function(e,t){return u(this,void 0,Promise,(function(){var n,r,a=this;return s(this,(function(o){return n=this.createCacheKey("db."+e+"."+t),r=this.datasource.getSchemaMapper(),[2,F(n,(function(){return u(a,void 0,void 0,(function(){var n,a,o,i,l,u;return s(this,(function(s){switch(s.label){case 0:return n=r.getMappingByValue(t),[4,this.findSchema(e,t,n)];case 1:return(a=s.sent())?(null==n?void 0:n.type)!==x.function?[3,3]:(o=a,[4,this.datasource.getFunctionSchema(e,n.value)]):[2,[]];case 2:o.OrderedColumns=s.sent(),s.label=3;case 3:return i=a.OrderedColumns.filter((function(e){return"dynamic"===e.CslType})).map((function(e){return e.Name})),[4,this.datasource.getDynamicSchema(e,null!==(u=null==n?void 0:n.name)&&void 0!==u?u:t,i)];case 4:return l=s.sent(),[2,a.OrderedColumns.reduce((function(e,t){var n=l[t.Name];return Array.isArray(n)?(Array.prototype.push.apply(e,n),e):(e.push(t),e)}),[])]}}))}))}))]}))}))},e.prototype.findSchema=function(e,t,n){var r;return u(this,void 0,Promise,(function(){var a,o,i,l,u,c,d,m;return s(this,(function(s){switch(s.label){case 0:return[4,Promise.all([this.getTablesForDatabase(e),this.getFunctionsForDatabase(e),this.getViewsForDatabase(e)])];case 1:return a=p.apply(void 0,[s.sent(),3]),o=a[0],i=a[1],l=a[2],u=null!==(r=null==n?void 0:n.name)&&void 0!==r?r:t,(c=o.find((function(e){return e.Name===u})))?[2,c]:(d=l.find((function(e){return e.Name===u})))?[2,d]:(m=i.find((function(e){return e.Name===u})))?[2,{Name:m.Name,OrderedColumns:m.OutputColumns}]:[2]}}))}))},e}(),zt=function(e){var t=Object(_e.useTheme)(),n=Ht(t);return oe.a.createElement("div",{className:n.container},oe.a.createElement("div",{className:n.icon},oe.a.createElement(_e.Icon,{className:"spin-clockwise",name:"sync"})),oe.a.createElement("span",null,"One moment, your schema is loading ..."))},Ut=function(e){var t=Object(_e.useTheme)(),n=Ht(t);return oe.a.createElement("div",{className:n.container},oe.a.createElement("div",{className:n.icon},oe.a.createElement(_e.Icon,{name:"exclamation-triangle",className:n.error})),oe.a.createElement("span",{className:n.error},e.message))},Kt=function(e){var t=Object(_e.useTheme)(),n=Ht(t);return oe.a.createElement("div",{className:n.container},oe.a.createElement("div",{className:n.icon},oe.a.createElement(_e.Icon,{name:"exclamation-triangle",className:n.warning})),oe.a.createElement("span",{className:n.warning},e.message))},Ht=Object(_e.stylesFactory)((function(e){return{container:Object(Ae.css)(ke||(ke=m(["\n      margin-top: 10px;\n      display: flex;\n      flex-direction: row;\n    "],["\n      margin-top: 10px;\n      display: flex;\n      flex-direction: row;\n    "]))),icon:Object(Ae.css)(Ne||(Ne=m(["\n      margin-right: 4px;\n    "],["\n      margin-right: 4px;\n    "]))),error:Object(Ae.css)(De||(De=m(["\n      color: ",";\n    "],["\n      color: ",";\n    "])),e.colors.formInputBorderInvalid),warning:Object(Ae.css)(Me||(Me=m(["\n      color: ",";\n    "],["\n      color: ",";\n    "])),e.palette.yellow)}})),Zt=function(e){var t,n,r,a,o,l,c,p,d,m,f,v,h,g,b,w=e.query,x=e.database,O=e.datasource,E=e.schema,S=e.onChangeQuery,j=O.id,T=O.parseExpression,F=O.autoCompleteQuery,V=O.getSchemaMapper,N=Ge(w.resultFormat),D=Object(y.getTemplateSrv)().replace(x),M=tn(E,D,O),_=en(M,w,O),A=Object(y.getTemplateSrv)().replace(null!==(t=null==_?void 0:_.property.name)&&void 0!==t?t:""),P=V().getMappingByValue(null==_?void 0:_.property.name),q=on(),R=ue((function(){return u(void 0,void 0,void 0,(function(){var e,t,n,r,a,o,l;return s(this,(function(u){switch(u.label){case 0:return _&&_.property?(e=null!==(a=null==P?void 0:P.value)&&void 0!==a?a:A,[4,nn(O,D,e)]):[2,[]];case 1:return t=u.sent(),n=null!==(o=w.expression)&&void 0!==o?o:C.expression,r=null!==(l=n.from)&&void 0!==l?l:_,S(i(i({},w),{query:T(i(i({},n),{from:r}),t)})),[2,t]}}))}))}),[j,D,A,null==P?void 0:P.value]),I=Object(ae.useCallback)((function(e,t){return u(void 0,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,F({search:t,database:D,expression:w.expression,index:e},R.value)];case 1:return[2,n.sent().map((function(e){return{value:e,label:e}}))]}}))}))}),[F,D,R.value,w.expression]),$=Yt(R.value),B=Jt($),L=Object(ae.useCallback)((function(e){if(k(e)&&_){var t=i(i({},C.expression),{from:e});S(i(i({},w),{resultFormat:N,database:x,expression:t}))}}),[S,w,N,x,_]),Q=Object(ae.useCallback)((function(e){var t=i(i({},w.expression),{from:_,where:e});S(i(i({},w),{resultFormat:N,database:x,expression:t,query:T(t,R.value)}))}),[S,w,R.value,N,x,_,T]),G=Object(ae.useCallback)((function(e){var t=i(i({},w.expression),{from:_,reduce:e});S(i(i({},w),{resultFormat:N,database:x,expression:t,query:T(t,R.value)}))}),[S,w,R.value,N,x,_,T]),W=Object(ae.useCallback)((function(e){var t=i(i({},w.expression),{from:_,groupBy:e});S(i(i({},w),{resultFormat:N,database:x,expression:t,query:T(t,R.value)}))}),[S,w,R.value,N,x,_,T]),z=Object(ae.useCallback)((function(e){var t=i(i({},w.expression),{from:_});S(i(i({},w),{expression:t,database:x,resultFormat:e}))}),[S,_,x,w]),U=Object(ae.useCallback)((function(e){if(k(e)&&_){var t=i(i(i({},C.expression),w.expression),{from:_,timeshift:e});S(i(i({},w),{resultFormat:N,database:x,expression:t,query:T(t,R.value)}))}}),[S,w,N,x,_,T,R.value]);if(R.loading)return oe.a.createElement(oe.a.Fragment,null,oe.a.createElement(Bt,{templateVariableOptions:e.templateVariableOptions,label:"From",value:_,fields:M,onChange:L}),oe.a.createElement(zt,null));if(R.error)return oe.a.createElement(oe.a.Fragment,null,oe.a.createElement(Bt,{templateVariableOptions:e.templateVariableOptions,label:"From",value:_,fields:M,onChange:L}),oe.a.createElement(Ut,{message:"Could not load table schema: "+(null===(n=R.error)||void 0===n?void 0:n.message)}));if(0===(null===(r=R.value)||void 0===r?void 0:r.length))return oe.a.createElement(oe.a.Fragment,null,oe.a.createElement(Bt,{templateVariableOptions:e.templateVariableOptions,label:"From",value:_,fields:M,onChange:L}),oe.a.createElement(Kt,{message:"Table schema loaded successfully but without any columns"}));var K=Xt();return oe.a.createElement(oe.a.Fragment,null,oe.a.createElement(Bt,{templateVariableOptions:e.templateVariableOptions,label:"From",value:_,fields:M,onChange:L},oe.a.createElement(Le,{format:N,includeAdxTimeFormat:!1,onChangeFormat:z})),oe.a.createElement(Lt,{templateVariableOptions:e.templateVariableOptions,label:"Where (filter)",value:null!==(o=null===(a=w.expression)||void 0===a?void 0:a.where)&&void 0!==o?o:null===(l=C.expression)||void 0===l?void 0:l.where,fields:$,onChange:Q,getSuggestions:I}),oe.a.createElement(Qt,{templateVariableOptions:e.templateVariableOptions,label:"Aggregate",value:null!==(p=null===(c=w.expression)||void 0===c?void 0:c.reduce)&&void 0!==p?p:null===(d=C.expression)||void 0===d?void 0:d.reduce,fields:$,onChange:G}),oe.a.createElement(Gt,{templateVariableOptions:e.templateVariableOptions,label:"Group by",value:null!==(f=null===(m=w.expression)||void 0===m?void 0:m.groupBy)&&void 0!==f?f:null===(v=C.expression)||void 0===v?void 0:v.groupBy,fields:B,onChange:W}),oe.a.createElement("hr",null),oe.a.createElement(Bt,{templateVariableOptions:[],label:"Timeshift",value:null!==(g=null===(h=w.expression)||void 0===h?void 0:h.timeshift)&&void 0!==g?g:null===(b=C.expression)||void 0===b?void 0:b.timeshift,fields:q,onChange:U,allowCustom:!0}),oe.a.createElement("div",{className:K.query},oe.a.createElement(_e.TextArea,{cols:80,rows:8,value:e.query.query,disabled:!0})))},Xt=Object(_e.stylesFactory)((function(){return{query:Object(Ae.css)(rn||(rn=m(["\n      margin-top: 12px;\n    "],["\n      margin-top: 12px;\n    "])))}})),Jt=function(e){return Object(ae.useMemo)((function(){return e.filter((function(e){return e.type===j.DateTime||j.String}))}),[e])},Yt=function(e){return Object(ae.useMemo)((function(){return e?(t=e,Array.isArray(t)?t.map((function(e){return{value:e.Name,label:e.Name,type:z(e.CslType)}})):[]):[];var t}),[e])},en=function(e,t,n){var r,a,o=n.variables,i=null===(a=null===(r=t.expression)||void 0===r?void 0:r.from)||void 0===a?void 0:a.property.name;return Object(ae.useMemo)((function(){var t=e.find((function(e){return e.value===i}));if(t)return{type:f.Property,property:He(t)};var n=o.find((function(e){return e===i}));return n?{type:f.Property,property:{name:n,type:j.String}}:e.length>0?{type:f.Property,property:He(e[0])}:void 0}),[e,i,o])},tn=function(e,t,n){var r=n.getSchemaMapper();return Object(ae.useMemo)((function(){return e&&e.Databases?r.getTableOptions(e,t):[]}),[t,e,r])};function nn(e,t,n){return u(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,new Wt(e).getColumnsForTable(t,n)];case 1:return[2,r.sent()]}}))}))}var rn,an,on=function(){return Object(ae.useMemo)((function(){return[{label:"No timeshift",value:"",type:j.TimeSpan},{label:"Hour before",value:"1h",type:j.TimeSpan},{label:"Day before",value:"1d",type:j.TimeSpan},{label:"Week before",value:"7d",type:j.TimeSpan}]}),[])},ln=function(e){var t=e.dirty,n=e.editorMode,r=e.onToggleEditorMode,a=p(Object(ae.useState)(!1),2),o=a[0],i=a[1],l=Object(ae.useCallback)((function(){t&&n!==b.Visual?i(!0):r()}),[i,r,t,n]),u=un();return oe.a.createElement(Ke,{label:"Database"},oe.a.createElement(_e.Select,{width:30,options:e.databases,placeholder:"Select database",value:e.database,onChange:function(t){t&&t.value&&e.onChangeDatabase(t.value)}}),e.editorMode===b.Raw&&oe.a.createElement(oe.a.Fragment,null,oe.a.createElement("div",{className:u.spacing}),oe.a.createElement("label",{className:"gf-form-label"},"(Run Query: Shift+Enter, Trigger Suggestion: Ctrl+Space)")),oe.a.createElement("div",{className:"gf-form gf-form--grow"},oe.a.createElement("div",{className:"gf-form-label--grow"})),oe.a.createElement(_e.Button,{variant:"secondary",onClick:l},e.editorMode===b.Visual?"Edit KQL":"Switch to builder"),oe.a.createElement("div",{className:u.spacing}),oe.a.createElement(_e.Button,{variant:e.dirty?"primary":"secondary",onClick:e.onRunQuery},"Run Query"),oe.a.createElement(_e.ConfirmModal,{isOpen:o,title:"Are you sure?",body:"You might loose manual changes done to the query if you go back to the visual builder.",confirmText:"Yes, I am sure.",dismissText:"No, continue edit query manually.",icon:"exclamation-triangle",onConfirm:function(){i(!1),e.onToggleEditorMode()},onDismiss:function(){return i(!1)}}))},un=Object(_e.stylesFactory)((function(){return{spacing:Object(Ae.css)(an||(an=m(["\n      margin-right: 4px;\n    "],["\n      margin-right: 4px;\n    "])))}}));function sn(e){return(sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var cn=function(e){var t,n;return"string"==typeof(null===(n=null===(t=null==e?void 0:e.from)||void 0===t?void 0:t.expression)||void 0===n?void 0:n.value)},pn=function(e){var t,n,r,a,o,l,u,s,c,p,d,m,v,h,y;if(!e)return C.expression;var g=i({},C.expression);return"string"==typeof(null===(n=null===(t=null==e?void 0:e.from)||void 0===t?void 0:t.expression)||void 0===n?void 0:n.value)&&(g.from=hn(null===(r=null==e?void 0:e.from)||void 0===r?void 0:r.expression)),Array.isArray(null===(o=null===(a=null==e?void 0:e.where)||void 0===a?void 0:a.expression)||void 0===o?void 0:o.expressions)&&(g.where={type:f.And,expressions:null===(u=null===(l=null==e?void 0:e.where)||void 0===l?void 0:l.expression)||void 0===u?void 0:u.expressions.map(mn).filter((function(e){return!!e})).map((function(e){return{type:f.Or,expressions:[e]}}))}),Array.isArray(null===(c=null===(s=null==e?void 0:e.reduce)||void 0===s?void 0:s.expression)||void 0===c?void 0:c.expressions)&&(g.reduce=dn(null===(d=null===(p=null==e?void 0:e.reduce)||void 0===p?void 0:p.expression)||void 0===d?void 0:d.expressions)),Array.isArray(null===(v=null===(m=null==e?void 0:e.groupBy)||void 0===m?void 0:m.expression)||void 0===v?void 0:v.expressions)&&(g.groupBy=dn(null===(y=null===(h=null==e?void 0:e.groupBy)||void 0===h?void 0:h.expression)||void 0===y?void 0:y.expressions)),g},dn=function(e){return Array.isArray(e)?{type:f.And,expressions:e.map(mn).filter((function(e){return!!e}))}:{type:f.And,expressions:[]}},mn=function(e){switch(null==e?void 0:e.type){case"fieldAndOperator":return yn(e);case"field":return hn(e);case"reduce":return vn(e);case"groupBy":return fn(e);default:return}},fn=function(e){if("groupBy"===(null==e?void 0:e.type)&&"object"===sn(null==e?void 0:e.field))return"object"!==sn(null==e?void 0:e.interval)?{type:f.GroupBy,property:gn(null==e?void 0:e.field)}:{type:f.GroupBy,property:gn(null==e?void 0:e.field),interval:gn(null==e?void 0:e.interval)}},vn=function(e){if("reduce"===(null==e?void 0:e.type)&&"object"===sn(null==e?void 0:e.field))return Array.isArray(null==e?void 0:e.parameters)?{type:f.Reduce,property:gn(null==e?void 0:e.field),reduce:gn(null==e?void 0:e.reduce),parameters:e.parameters}:{type:f.Reduce,property:gn(null==e?void 0:e.field),reduce:gn(null==e?void 0:e.reduce)}},hn=function(e){if("field"===(null==e?void 0:e.type)&&"string"==typeof(null==e?void 0:e.value))return{type:f.Property,property:gn(e)}},yn=function(e){var t,n,r,a,o,i,l,u;if("string"==typeof(null===(t=null==e?void 0:e.field)||void 0===t?void 0:t.value)&&"string"==typeof(null===(r=null===(n=null==e?void 0:e.operator)||void 0===n?void 0:n.operator)||void 0===r?void 0:r.value))return{type:f.Operator,property:gn(null==e?void 0:e.field),operator:{name:null===(o=null===(a=null==e?void 0:e.operator)||void 0===a?void 0:a.operator)||void 0===o?void 0:o.value,value:null!==(l=null===(i=null==e?void 0:e.operator)||void 0===i?void 0:i.value)&&void 0!==l?l:null===(u=null==e?void 0:e.operator)||void 0===u?void 0:u.values}}},gn=function(e){return{type:bn(e.fieldType),name:e.value}},bn=function(e){switch(e){case"boolean":return j.Boolean;case"dateTime":return j.DateTime;case"function":return j.Function;case"number":return j.Number;case"interval":return j.Interval;default:return j.String}};function wn(e){var t;return!(void 0!==e.rawMode||!e.query||(null===(t=e.expression)||void 0===t?void 0:t.from))||(e.rawMode||!1)}var xn=function(e,t,n){return Object(ae.useMemo)((function(){var r=e.find((function(e){return e.value===t.database}));if(r)return r.value;var a=n.variables.find((function(e){return e===t.database}));return a||(e.length>0?e[0].value:"")}),[e,t.database,n.variables])},Cn=function(e){return Object(ae.useMemo)((function(){var t,n,r=[];if(!e||!e.Databases)return r;try{for(var a=c(Object.keys(e.Databases)),o=a.next();!o.done;o=a.next()){var i=o.value,l=e.Databases[i];r.push(W(l))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return r}),[e])},On=function(e){return Object(ae.useMemo)((function(){var t,n,r;return null!==(r=null===(n=null===(t=null==e?void 0:e.series[0])||void 0===t?void 0:t.meta)||void 0===n?void 0:n.executedQueryString)&&void 0!==r?r:""}),[e])},En=function(e,t){return Object(ae.useMemo)((function(){return e!==t}),[e,t])},Sn=function(e){return Object(ae.useMemo)((function(){var t,n,r,a=null===(r=null===(n=null===(t=null==e?void 0:e.series[0])||void 0===t?void 0:t.meta)||void 0===n?void 0:n.custom)||void 0===r?void 0:r.KustoError;return(null==e?void 0:e.error)&&!a?e.error.message?""+e.error.message:""+e.error:a}),[e])},jn=function(e){var t=e.variables;return Object(ae.useMemo)((function(){return{label:"Template Variables",expanded:!1,options:t.map((function(e){return{label:e,value:e}}))}}),[t])};var Tn=/^(\d+)(?:\.(\d+))?(?:\.(\d+))?(?:-([0-9A-Za-z\.]+))?/,Fn=function(){function e(e){this.major=0,this.minor=0,this.patch=0,this.meta="";var t=Tn.exec(e);t&&(this.major=Number(t[1]),this.minor=Number(t[2]||0),this.patch=Number(t[3]||0),this.meta=t[4])}return e.prototype.isGtOrEq=function(t){for(var n=new e(t),r=0;r<this.comparable.length;++r){if(this.comparable[r]>n.comparable[r])return!0;if(this.comparable[r]<n.comparable[r])return!1}return!0},e.prototype.isValid=function(){return Object(v.isNumber)(this.major)},Object.defineProperty(e.prototype,"comparable",{get:function(){return[this.major,this.minor,this.patch]},enumerable:!1,configurable:!0}),e}();var Vn={strongconsistency:"Strong",weakconsistency:"Weak"},kn=function(){function e(e){var t,n,r,a=this;this.$scope=e,this.loading=!1,this.schemaError=!1,this.hasRequiredGrafanaVersion=this.hasMinVersion(),this.suggestUrl="https://yourcluster.kusto.windows.net",e.getSuggestUrls=function(){return[a.suggestUrl]},this.databases=[],this.schemaMappingOptions=[],Array.isArray(null===(t=this.current.jsonData)||void 0===t?void 0:t.schemaMappings)||(this.current.jsonData.schemaMappings=[]),this.current.id&&(this.current.url="api/datasources/proxy/"+this.current.id,this.datasource=new X(this.current),this.refreshSchema()),this.editorModes=Object.keys(b).filter((function(e){return isNaN(parseInt(e,10))})).map((function(e){return{value:b[e],label:e}})),(null===(n=this.current.jsonData)||void 0===n?void 0:n.defaultEditorMode)||(this.current.jsonData.defaultEditorMode=this.editorModes[0].value),this.dataConsistency=Object.keys(Vn).map((function(e){return{value:e,label:Vn[e]}})),(null===(r=this.current.jsonData)||void 0===r?void 0:r.dataConsistency)||(this.current.jsonData.dataConsistency=this.dataConsistency[0].value)}return e.$inject=["$scope"],e.prototype.addSchemaMapping=function(){this.mapping&&(this.current.jsonData.schemaMappings.push({database:this.mapping.database,type:this.mapping.type,name:this.mapping.value,displayName:this.mapping.name,value:this.formatMappingValue(this.mapping)}),this.mapping=void 0)},e.prototype.removeSchemaMapping=function(e){this.current.jsonData.schemaMappings.splice(e,1)},e.prototype.formatMappingValue=function(e){var t;switch(null==e?void 0:e.type){case"function":var n=null!==(t=e.input)&&void 0!==t?t:[];return e.value+"("+n.map((function(e){return e.Value})).join(",")+")";default:return e.value}},e.prototype.formatMappingText=function(e){return e.database+"/"+e.type+"s/"+e.value},e.prototype.refreshSchema=function(){var e=this;if(this.datasource){this.loading=!0;var t=[],n=[];this.datasource.getSchema(!0).then((function(r){var a,o,i,l,u,s,p,d;try{for(var m=c(Object.keys(r.Databases)),f=m.next();!f.done;f=m.next()){var v=f.value,h=r.Databases[v];t.push({text:h.Name,value:h.Name});try{for(var y=(i=void 0,c(Object.keys(h.Tables))),g=y.next();!g.done;g=y.next()){var b=g.value,w=h.Tables[b];n.push({type:"table",text:h.Name+"/tables/"+w.Name,value:w.Name,name:w.Name,database:h.Name})}}catch(e){i={error:e}}finally{try{g&&!g.done&&(l=y.return)&&l.call(y)}finally{if(i)throw i.error}}try{for(var x=(u=void 0,c(Object.keys(h.Functions))),C=x.next();!C.done;C=x.next()){var O=C.value,E=h.Functions[O];n.push({type:"function",text:h.Name+"/functions/"+E.Name,value:E.Name,name:E.Name,input:E.InputParameters,database:h.Name})}}catch(e){u={error:e}}finally{try{C&&!C.done&&(s=x.return)&&s.call(x)}finally{if(u)throw u.error}}try{for(var S=(p=void 0,c(Object.keys(h.MaterializedViews))),j=S.next();!j.done;j=S.next()){var T=j.value,F=h.MaterializedViews[T];n.push({type:"materializedView",text:h.Name+"/materializedViews/"+F.Name,value:F.Name,name:F.Name,database:h.Name})}}catch(e){p={error:e}}finally{try{j&&!j.done&&(d=S.return)&&d.call(S)}finally{if(p)throw p.error}}}}catch(e){a={error:e}}finally{try{f&&!f.done&&(o=m.return)&&o.call(m)}finally{if(a)throw a.error}}!e.current.jsonData.defaultDatabase&&e.databases.length&&(e.current.jsonData.defaultDatabase=e.databases[0].value),e.databases=t,e.schemaMappingOptions=n,e.loading=!1,e.schemaError=!1,e.$scope.$digest()})).catch((function(t){console.error("ADX failed to fetch schema: ",t),e.loading=!1,e.schemaError=!0,e.$scope.$digest()}))}},e.prototype.hasMinVersion=function(){return e=Re.a.buildInfo.latestVersion,t="5.3",new Fn(e).isGtOrEq(t)||"5.3.0-beta1"===Re.a.buildInfo.version||"5.3.0-pre1"===Re.a.buildInfo.version;var e,t},e.prototype.showMinVersionWarning=function(){return!this.hasRequiredGrafanaVersion},e.templateUrl="partials/config.html",e}(),Nn=n(9);function Dn(e,t,n){var r=t.find("#content")[0];function a(e,t){var n=new Pe(e,t.defaultTimeField,t.getSchema,Re.a);n.initMonaco(t.content),n.addCommand(monaco.KeyMod.Shift|monaco.KeyCode.Enter,(function(){var e=n.getValue();t.content=e,t.onChange()})),t.$watch("content",(function(e,r){var a=n.getValue();e!==a&&e!==r&&t.$$postDigest((function(){n.setEditorContent(e)}))})),n.setOnDidChangeModelContent((function(){t.$apply((function(){var e=n.getValue();t.content=e}))})),t.$on("$destroy",(function(){n.disposeMonaco()})),window.onresize=function(){n.resize()}}window.hasOwnProperty("monaco")?setTimeout((function(){a(r,e)}),100):window.System.import("/"+e.pluginBaseUrl+"/libs/monaco.min.js").then((function(){setTimeout((function(){a(r,e)}),100)})),r.onblur=function(){e.onChange()},r.onkeydown=function(e){if("Escape"===e.key)return e.stopPropagation(),!0}}n.n(Nn).a.module("grafana.controllers").directive("kustoMonacoEditor",(function(){return{restrict:"E",template:'<div id="content" tabindex="0" style="width: 100%; height: 150px"></div>',scope:{content:"=",onChange:"&",getSchema:"&",defaultTimeField:"@",pluginBaseUrl:"@"},link:Dn}}));var Mn=function(){function e(){this.showHelp=!1,this.defaultQuery='<your table>\n| where $__timeFilter() \n| project TimeGenerated, Text=YourTitleColumn, Tags="tag1,tag2"',this.annotation.query=this.annotation.query||this.defaultQuery,this.annotation.resultFormat="table",this.databases=this.getDatabases()}return e.prototype.getDatabases=function(){var e=this;return this.databases&&this.databases.length>0?this.databases:this.datasource.getDatabases().then((function(t){return e.databases=t,t.length>0&&!e.annotation.database&&(e.annotation.database=t[0].value),e.databases})).catch((function(e){}))},e.templateUrl="partials/annotations.editor.html",e}();n.d(t,"plugin",(function(){return _n}));var _n=new r.DataSourcePlugin(X).setConfigCtrl(kn).setAnnotationQueryCtrl(Mn).setQueryEditor((function(e){var t,n,r,a,o=e.datasource,l=e.onChange,u=e.onRunQuery,s=e.query,c=On(e.data),p=Sn(e.data),m=En(e.query.query,c),f=function(e){var t;if(void 0===e.query.rawMode&&e.query.query&&!(null===(t=e.query.expression)||void 0===t?void 0:t.from))return!0;return e.query.rawMode||!1}(e),v=ue((function(){return o.getSchema(!1)}),[o.id]),h=jn(o),y=Cn(v.value),g=xn(y,e.query,o);Object(ae.useEffect)((function(){(function(e){return!!e&&(!e.pluginVersion||(!e.querySource||!!cn(e.expression)))})(s)&&(l(function(e){return i(i(i({},C),e),{rawMode:wn(e),pluginVersion:C.pluginVersion,expression:(t=e.expression,cn(t)?pn(t):null!=t?t:C.expression)});var t}(s)),u()),function(e){return void 0===e.query.rawMode}(e)&&function(e){return e.datasource.getDefaultEditorMode()===b.Raw}(e)&&(l(i(i({},e.query),{rawMode:!0,querySource:b.Raw})),u())}),[]);var w=Object(ae.useCallback)((function(e){l(i(i({},s),{database:e}))}),[l,s]),x=Object(ae.useCallback)((function(){l(i(i({},s),{rawMode:!f,querySource:f?b.Visual:b.Raw}))}),[l,s,f]);if(v.loading)return oe.a.createElement(zt,null);if(v.error)return(null===(n=null===(t=v.error)||void 0===t?void 0:t.data)||void 0===n?void 0:n.Message)?oe.a.createElement("div",{className:"gf-form"},oe.a.createElement("pre",{className:"gf-form-pre alert alert-error"},"Could not load datasource schema due too: ",null===(a=null===(r=v.error)||void 0===r?void 0:r.data)||void 0===a?void 0:a.Message)):oe.a.createElement("div",{className:"gf-form"},oe.a.createElement("pre",{className:"gf-form-pre alert alert-error"},"Could not load datasource schema: ",String(v.error)));if(0===y.length)return oe.a.createElement("div",{className:"gf-form"},oe.a.createElement("pre",{className:"gf-form-pre alert alert-warning"},"Datasource schema loaded but without any databases and tables, please try again.."));var O=f?b.Raw:b.Visual;return oe.a.createElement(oe.a.Fragment,null,p&&oe.a.createElement("div",{className:"gf-form"},oe.a.createElement("pre",{className:"gf-form-pre alert alert-warning"},"Failed to execute query: ",p)),oe.a.createElement(ln,{onRunQuery:e.onRunQuery,onToggleEditorMode:x,editorMode:O,onChangeDatabase:w,database:g,databases:d([h],y),dirty:m}),O===b.Raw&&oe.a.createElement(ze,i({},e,{schema:v.value,templateVariableOptions:h,lastQuery:c,database:g})),O===b.Visual&&oe.a.createElement(Zt,{datasource:o,database:g,onChangeQuery:e.onChange,query:e.query,schema:v.value,templateVariableOptions:h}))}))}])}));
//# sourceMappingURL=module.js.map